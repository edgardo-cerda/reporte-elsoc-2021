---
editor_options: 
  markdown: 
    wrap: 72
---

# Identificación Política



## Identificación política

#### Identificación política por ola

<!-- ### 2.1 Identificación política por ola -->

```{r echo=FALSE}

elsoc_long_2016_2021 %>%
  filter(tipo_atricion == 1 & !c15 %in% c(-888, -999)) %>%
  mutate(pos_id = factor(car::recode(c15, recodes = "0:4 = 1; 5 = 2; 6:10 = 3; 11:12 = 4"),
                         levels = c(1, 2, 3, 4),
                         labels = c('Izquierda', "Centro", "Derecha", "No se identifica"))) %>%
  prop(x = pos_id, by = ola, na.rm = TRUE) %>% 
  sjlabelled::as_label(ola) %>% 
  ggplot(aes(y = prop, x = pos_id, fill = ola, 
             label = scales::percent(prop, accuracy = .1))) +
  theme_bw() + 
  geom_col(position= 'dodge2') +
  scale_y_continuous(labels = scales::percent,
                     limits = c(0, 1)) +
  ylab(label = NULL) +
  xlab(label = NULL) +
  scale_fill_viridis_d(begin = 0, end = .85, direction = -1, option = 'viridis') +
  geom_text(vjust = -0.8,
            position = position_dodge(width = .9),
            size= 2.75) +
  theme(legend.position = 'top',
        legend.title = element_blank())

```

#### Cambios individual en Identificación política (2019-2021)

<!-- ### 2.2 Alluvial de cambios de Identificación política (+o-) -->

```{r}

datos_temp <- elsoc_long_2016_2021 %>% 
  filter(tipo_atricion == 1 & ola %in% c(4, 5)) %>% 
  mutate(pos_id = factor(car::recode(c15, recodes = "0:4 = 1; 5 = 2; 6:10 = 3; 11:12 = 4; c(-888, -999) = 5"),
                         levels = c(1, 2, 3, 4, 5),
                         labels = c('Izquierda', "Centro", "Derecha", "No se identifica", "NS/NR"))) %>%
  as_label(ola) %>% 
  survey_design_elsoc()

datos_alluvial <- svytable(~pos_id + ola + idencuesta, design = datos_temp) %>% 
  as.data.frame() %>% 
  group_by(ola) %>% 
  mutate(prop = Freq/sum(Freq)) %>%
  filter(Freq > 0)

etiquetas <- datos_alluvial %>% 
  group_by(ola, pos_id) %>% 
  summarise(prop = sum(prop, na.rm = TRUE),
            idencuesta = 1)

datos_alluvial %>% 
  ggplot(aes(y = prop, x = ola, fill = fct_rev(pos_id), 
             stratum = fct_rev(pos_id), alluvium = idencuesta)) +
  ggalluvial::geom_flow(alpha = .66) + 
  ggalluvial::geom_stratum(linetype = 0) +
  scale_y_continuous(labels = scales::percent) + 
  ylab(label = NULL) +
  xlab(label = NULL) + 
  theme(legend.position = 'top',
        legend.title = element_blank()) +
  scale_fill_viridis_d(direction = -1) +
  geom_text(data = etiquetas, 
            aes(label = scales::percent(ifelse(prop < .01, NA, prop), accuracy = .1)),
            position = position_stack(vjust = .5),
            show.legend = FALSE,
            size = 2.75,
            color = rep(c('white', 'white', 'white', 'black', 'black'), 2)) + 
  guides(fill = guide_legend(reverse = TRUE))

```

#### De acuerdo o Totalmente de acuerdo con la cuarentena según identificación política el año 2021


```{r}
elsoc_long_2016_2021 %>% 
  filter(ola == 5 & tipo_atricion == 1 & 
           !c37_10 %in% c(-888, -999) & !c15 %in% c(-888, -999)) %>% 
    mutate(pos_id = factor(car::recode(c15, recodes = "0:4 = 1; 5 = 2; 6:10 = 3; 11:12 = 4"),
                         levels = c(1, 2, 3, 4),
                         labels = c('Izquierda', "Centro", "Derecha", "No se identifica"))) %>%
  prop(c37_10 %in% 4:5, pos_id, na.rm = TRUE) %>% 
  sjlabelled::as_label(pos_id) %>% 
  ggplot(aes(y = prop, x = pos_id, fill = pos_id,
               label = scales::percent(prop, accuracy = .1))) +
  theme_bw() + 
    geom_col() +
    scale_y_continuous(labels = scales::percent,
                       limits = c(0, 1)) +
    ylab(label = NULL) +
    xlab(label = NULL) +
    scale_fill_viridis_d(begin = 0, end = .85, direction = -1, option = 'viridis') +
    geom_text(vjust = -0.8,
              position = position_dodge(width = .9),
              size= 2.75) +
    theme(legend.position = 'none',   
          legend.title = element_blank())

```


### 2.4 Grado de acuerdo con actividad económica versus salud pública según identificación política el año 2021

<!-- ### 2.4 Grado de acuerdo con la frase "Es más importante darle prioridad a la actividad económica que a la salud de la población" según identificación política -->

```{r}

elsoc_long_2016_2021 %>% 
  filter(ola == 5 & tipo_atricion == 1 & 
           !c37_09 %in% c(-888, -999) & !c15 %in% c(-888, -999)) %>% 
    mutate(pos_id = factor(car::recode(c15, recodes = "0:4 = 1; 5 = 2; 6:10 = 3; 11:12 = 4"),
                         levels = c(1, 2, 3, 4),
                         labels = c('Izquierda', "Centro", "Derecha", "No se identifica"))) %>%
  prop(c37_09 %in% 4:5, pos_id, na.rm = TRUE) %>% 
  sjlabelled::as_label(c37_09, pos_id) %>% 
  ggplot(aes(y = prop, x = pos_id, fill = pos_id, 
               label = scales::percent(prop, accuracy = .1))) +
  theme_bw() + 
    geom_col() +
    scale_y_continuous(labels = scales::percent, limits = c(0,1)) + 
    ylab(label = NULL) +
    xlab(label = NULL) +
    scale_fill_viridis_d(begin = 0, end = .85, direction = -1, option = 'viridis') +
    geom_text(vjust = -0.8,
              position = position_dodge(width = .9),
              size= 2.75) +
    theme(legend.position = 'none',   
          legend.title = element_blank())

```

### 2.6 Grado de acuerdo con el aborto según identificación política

```{r}

elsoc_long_2016_2021 %>%
  filter(tipo_atricion == 1 & ola %in% 3:5 & !c37_02 %in% c(-888, -999) & !c15 %in% c(-888, -999)) %>%
  mutate(pos_id = factor(car::recode(c15, recodes = "0:4 = 1; 5 = 2; 6:10 = 3; 11:12 = 4"),
                         levels = c(1, 2, 3, 4),
                         labels = c('Izquierda', "Centro", "Derecha", "No se identifica"))) %>%
  prop(c37_02 %in% 4:5, by = c(ola, pos_id), na.rm = TRUE) %>%
  as_label(ola) %>% 
  ggplot(aes(y = prop, x = pos_id, fill = ola,  
               label = scales::percent(prop, accuracy = .1))) +
    theme_bw() + 
    geom_col(position= 'dodge2') +
    scale_y_continuous(labels = scales::percent,
                       limits = c(0, 1)) +
    ylab(label = NULL) +
    xlab(label = NULL) +
    scale_fill_viridis_d(begin = 0, end = .85, direction = -1, option = 'viridis') +
    geom_text(vjust = -0.8,
              position = position_dodge(width = .9),
              size= 2.75) +
    theme(legend.position = 'top',
          legend.title = element_blank())

```

### 2.7 Grado de acuerdo con la capitalizacion individual pensiones según identificación política

```{r}

elsoc_long_2016_2021 %>%
  filter(tipo_atricion == 1 & ola %in% 3:5 & !c37_02 %in% c(-888, -999) & !c15 %in% c(-888, -999)) %>%
  mutate(pos_id = factor(car::recode(c15, recodes = "0:4 = 1; 5 = 2; 6:10 = 3; 11:12 = 4"),
                         levels = c(1, 2, 3, 4),
                         labels = c('Izquierda', "Centro", "Derecha", "No se identifica"))) %>%
  prop(c37_02 %in% 4:5, by = c(ola, pos_id), na.rm = TRUE) %>%
  as_label(ola) %>% 
  ggplot(aes(y = prop, x = pos_id, fill = ola,  
               label = scales::percent(prop, accuracy = .1))) +
    theme_bw() + 
    geom_col(position= 'dodge2') +
    scale_y_continuous(labels = scales::percent,
                       limits = c(0, 1)) +
    ylab(label = NULL) +
    xlab(label = NULL) +
    scale_fill_viridis_d(begin = 0, end = .85, direction = -1, option = 'viridis') +
    geom_text(vjust = -0.8,
              position = position_dodge(width = .9),
              size= 2.75) +
    theme(legend.position = 'top',
          legend.title = element_blank())

```

### 2.8 Grado de acuerdo con las restricciones de ingreso de migrantes según identificación política (2019)

```{r}
elsoc_long_2016_2021 %>%
  filter(tipo_atricion == 1 & ola %in% 3:5 & 
           !c37_05 %in% c(-888, -999) & !c15 %in% c(-888, -999)) %>%
    mutate(pos_id = factor(car::recode(c15, recodes = "0:4 = 1; 5 = 2; 6:10 = 3; 11:12 = 4"),
                         levels = c(1, 2, 3, 4),
                         labels = c('Izquierda', "Centro", "Derecha", "No se identifica"))) %>%
  prop(x = c37_05 %in% 4:5, by = c(ola, pos_id), na.rm = TRUE) %>% 
  as_label(ola) %>% 
  ggplot(aes(y = prop, x = pos_id, fill = ola, 
               label = scales::percent(prop, accuracy = .1))) +
    theme_bw() + 
    geom_col(position= 'dodge2') +
    scale_y_continuous(labels = scales::percent,
                       limits = c(0, 1)) +
    ylab(label = NULL) +
    xlab(label = NULL) +
    scale_fill_viridis_d(begin = 0, end = .85, direction = -1, option = 'viridis') +
    geom_text(vjust = -0.8,
              position = position_dodge(width = .9),
              size= 2.75) +
    theme(legend.position = 'top',
          legend.title = element_blank())

```

