---
editor_options: 
  markdown: 
    wrap: 72
---

# Actitudes hacia la democracia

## Apoyo a la Democracia

### 3.1 ¿Con cuál de las siguientes frases está usted más de acuerdo?

<!-- ### 3.1 ¿Con cuál de las siguientes frases está usted más de acuerdo? -->

```{r, include=FALSE}
sjmisc::frq(elsoc_long_2016_2021$c25)
elsoc_panel_m1 <- elsoc_long_2016_2021 %>% 
  filter(tipo_atricion == 1 & !ola %in% c(1,2)) %>% 
  group_by(idencuesta) %>% 
  mutate(aut_dem = factor(c25, levels = c(1, 2, 3, 4),
                         labels = c('Democracia es preferible a\ncualquier otra forma\nde gobierno', 'En algunos casos,\n gobierno autoritario puede\n ser preferible', 'Da lo mismo régimen\ndemocrático o autoritario', 'Ninguna'))) %>%
  mutate(missing = any(aut_dem %in% c("NA"))) %>% 
  filter(!missing) %>% 
  ungroup() %>%
  sjlabelled::as_label(ola) %>% 
  survey_design_elsoc()

datos.3.1 <- data.frame((svytable(~aut_dem + ola + idencuesta, elsoc_panel_m1, round = F))) %>% 
  dplyr::filter(Freq>0)  %>% 
  group_by(ola) %>% 
  mutate(porcentaje=Freq/sum(Freq)) %>% 
  na.omit()

etiquetas.3.1 <- data.frame((svytable(~aut_dem + ola, elsoc_panel_m1, round = F))) %>% group_by(ola) %>% mutate(porcentaje=Freq/sum(Freq)) %>% na.omit() %>% 
  mutate(idencuesta = 1)

g.3.1 <- ggplot(datos.3.1, aes(x = ola, fill = aut_dem, stratum = aut_dem,
                             alluvium = idencuesta, y = porcentaje))+
    ggalluvial::geom_flow(alpha = .66) + 
    ggalluvial::geom_stratum(linetype = 0) +
    scale_y_continuous(labels = scales::percent) + 
    ylab(label = NULL) +
    xlab(label = NULL) + 
    theme(legend.position = 'top',
          legend.title = element_blank()) +
    scale_fill_viridis_d(begin = 0, end = .95, direction = -1, option = 'viridis') +
    geom_text(data = etiquetas.3.1, 
              aes(label = ifelse(porcentaje > 0.03 , scales::percent(porcentaje, accuracy = .1),"")),
              position = position_stack(vjust = .5),
              show.legend = FALSE,
              size = 2,
              color = rep('white'))

g.3.1
```

### 3.2 Insatisfacción con la democracia por ola

<!-- ### 3.2 Insatisfacción con la democracia por ola -->

```{r}
datos.3.2 <- elsoc_long_2016_2021 %>%
  filter(tipo_atricion == 1 & !c01 %in% c(-999,-888)) %>%
  prop(c01 %in% c(1), by  = c(ola), na.rm = TRUE) %>%
  sjlabelled::as_label(ola, c01)

g.3.2 <- datos.3.2 %>% 
  ggplot(aes(y = prop, x = ola, group = 1,
               label = scales::percent(prop, accuracy = .1))) +
  theme_bw() + 
  geom_point() +
  geom_line() + 
  scale_y_continuous(labels = scales::percent,
                     limits = c(0, 1)) +
  ylab(label = NULL) +
  xlab(label = NULL) +
  scale_fill_viridis_d(begin = 0, end = .85, direction = -1, option = 'viridis') +
  geom_text(vjust = -0.8,
            position = position_dodge(width = .9),
            size= 2.75) +
  theme(legend.position = 'none',   
        legend.title = element_blank())
g.3.2
```

### 3.3 ¿Con cuál de las siguientes frases está usted más de acuerdo? (2021), según posición ideológica

<!-- ### 3.3. ¿Con cuál de las siguientes frases está usted más de acuerdo? (2019), según posición ideológica -->

```{r}
elsoc_long_2016_2021 %>%
  filter(tipo_atricion == 1 & !c25 %in% c(-888,-999) & 
           !c15 %in% c(-888, -999) & ola == 5) %>%
  mutate(pos_id = factor(car::recode(c15, recodes = "0:4 = 1; 5 = 2; 6:10 = 3; 11:12 = 4"),
                     levels = c(1, 2, 3, 4),
                     labels = c('Izquierda', "Centro", "Derecha", "No se identifica")),
         c25 = factor(c25, 
                      levels = c(1, 2, 3, 4),
                      labels = c('Democracia es preferible\na cualquier otra forma\nde gobierno', 
                                 'En algunos casos,\n gobierno autoritario puede\n ser preferible',
                                 'Da lo mismo régimen\ndemocrático o autoritario', 
                                 'Ninguna'))) %>%
  prop(x = c25, by = pos_id, na.rm = TRUE) %>% 
  sjlabelled::as_label(pos_id) %>% 
  ggplot(aes(y = prop, x = pos_id, fill = c25, 
             label = scales::percent(ifelse(prop < .01, NA, prop), accuracy = .1))) + 
  theme_bw() + 
  geom_col(position = 'Stack') +
  scale_y_continuous(labels = scales::percent) +
  ylab(label = NULL) +
  xlab(label = NULL) +
  scale_fill_viridis_d(begin = 0, end = .95, direction = -1, option = 'viridis') +
  geom_text(position = position_stack(vjust = .5),
            size= 2.75,
            color = rep(c('black', 'black', 'white', 'white'), 4)) + 
  theme(legend.position = 'top',
        legend.title = element_blank())

```





