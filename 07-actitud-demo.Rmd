---
editor_options: 
  markdown: 
    wrap: 72
---

# Actitudes hacia la democracia

## Apoyo a la Democracia

#### Preferencia y satisfacción con la democracia por ola (2016-2021)

```{r}

elsoc_long_2016_2021 %>%
  filter(tipo_atricion == 1 & !c01 %in% c(-999,-888) & !c25 %in% c(-888, -999)) %>%
  mutate(c01 = car::recode(c01, "1:3 = 2; 4:5 = 1")) %>% 
  pivot_longer(cols = c(c01, c25)) %>% 
  prop(value == 1, by  = c(ola, name), na.rm = TRUE) %>% 
  as_label(ola) %>% 
  mutate(name = factor(name,
                       levels = c('c25', 'c01'),
                       labels = c('Preferencia por la democracia sobre\ncualquier otra forma de gobierno', 'Satisfacción con la democracia'))) %>% 
  ggplot(aes(y = prop, x = ola, group = name, color = name,
               label = scales::percent(prop, accuracy = .1))) +
  theme_bw() + 
  geom_point(size = 1.5) +
  geom_line(size = .75) + 
  scale_y_continuous(labels = scales::percent,
                     limits = c(0, 1)) +
  ylab(label = NULL) +
  xlab(label = NULL) +
  scale_color_viridis_d(begin = 0, end = .66, direction = 1, option = 'viridis') +
  geom_text_repel(size= 3) +
  theme(legend.position = 'top',   
        legend.title = element_blank())

```

#### Preferencia y satisfacción con la democracia según posición ideológica (2021)

```{r}

elsoc_long_2016_2021 %>%
  filter(tipo_atricion == 1 & ola == 5 & !c01 %in% c(-999,-888) & 
           !c25 %in% c(-888, -999) & !c15 %in% c(-888, -999)) %>%
  mutate(c01 = car::recode(c01, "1:3 = 2; 4:5 = 1"),
         pos_id = factor(car::recode(c15, recodes = "0:4 = 1; 5 = 2; 6:10 = 3; 11:12 = 4"),
                     levels = c(1, 2, 3, 4),
                     labels = c('Izquierda', "Centro", "Derecha", "No se identifica"))) %>% 
  pivot_longer(cols = c(c01, c25)) %>% 
  prop(value == 1, by  = c(name, pos_id), na.rm = TRUE) %>% 
  mutate(name = factor(name,
                       levels = c('c25', 'c01'),
                       labels = c('Preferencia por la democracia sobre\ncualquier otra forma de gobierno', 'Satisfacción con la democracia'))) %>% 
  ggplot(aes(y = prop, x = pos_id, fill = name,
               label = scales::percent(prop, accuracy = .1))) +
  theme_bw() + 
  geom_col(position = 'dodge2') + 
  scale_y_continuous(labels = scales::percent,
                     limits = c(0, 1)) +
  ylab(label = NULL) +
  xlab(label = NULL) +
  scale_fill_viridis_d(begin = .33, end = .66, direction = 1, option = 'viridis') +
  geom_text(position = position_dodge(.9), vjust = -.5) + 
  theme(legend.position = 'top',   
        legend.title = element_blank())

```


#### Preferencia y satisfacción con la democracia según posición ideológica y ola (2016-2021)

```{r}

elsoc_long_2016_2021 %>%
  filter(tipo_atricion == 1 & !c01 %in% c(-999,-888) & 
           !c25 %in% c(-888, -999) & !c15 %in% c(-888, -999)) %>%
  mutate(c01 = car::recode(c01, "1:3 = 2; 4:5 = 1"),
         pos_id = factor(car::recode(c15, recodes = "0:4 = 1; 5 = 2; 6:10 = 3; 11:12 = 4"),
                     levels = c(1, 2, 3, 4),
                     labels = c('Izquierda', "Centro", "Derecha", "No se identifica"))) %>% 
  pivot_longer(cols = c(c01, c25)) %>% 
  prop(value == 1, by  = c(ola, name, pos_id), na.rm = TRUE) %>% 
  as_label(ola) %>% 
  mutate(name = factor(name,
                       levels = c('c25', 'c01'),
                       labels = c('Preferencia por la democracia\nsobre cualquier otra forma de gobierno', 'Satisfacción con la democracia'))) %>% 
  ggplot(aes(y = prop, x = ola, group = name, color = name,
               label = scales::percent(prop, accuracy = .1))) +
  facet_wrap(.~pos_id) +
  theme_bw() + 
  geom_point(size = 1.5) + 
  geom_line(size = .75) +
  scale_y_continuous(labels = scales::percent,
                     limits = c(0, 1)) +
  ylab(label = NULL) +
  xlab(label = NULL) +
  scale_color_viridis_d(begin = .1, end = .66, direction = 1, option = 'viridis') +
  geom_text_repel(size = 3) +
  theme(legend.position = 'top',   
        legend.title = element_blank())

```


#### ¿Con cuál de las siguientes frases está usted más de acuerdo? (2021), según posición ideológica

<!-- ### 3.3. ¿Con cuál de las siguientes frases está usted más de acuerdo? (2019), según posición ideológica -->

```{r}
elsoc_long_2016_2021 %>%
  filter(tipo_atricion == 1 & !c25 %in% c(-888,-999) & 
           !c15 %in% c(-888, -999) & ola == 5) %>%
  mutate(pos_id = factor(car::recode(c15, recodes = "0:4 = 1; 5 = 2; 6:10 = 3; 11:12 = 4"),
                     levels = c(1, 2, 3, 4),
                     labels = c('Izquierda', "Centro", "Derecha", "No se identifica")),
         c25 = factor(c25, 
                      levels = c(1, 2, 3, 4),
                      labels = c('Democracia es preferible\na cualquier otra forma\nde gobierno', 
                                 'En algunos casos,\n gobierno autoritario puede\n ser preferible',
                                 'Da lo mismo régimen\ndemocrático o autoritario', 
                                 'Ninguna'))) %>%
  prop(x = c25, by = pos_id, na.rm = TRUE) %>% 
  sjlabelled::as_label(pos_id) %>% 
  ggplot(aes(y = prop, x = pos_id, fill = fct_rev(c25), 
             label = scales::percent(ifelse(prop < .01, NA, prop), accuracy = .1))) + 
  theme_bw() + 
  geom_col(position = 'Stack') +
  scale_y_continuous(labels = scales::percent) +
  ylab(label = NULL) +
  xlab(label = NULL) +
  scale_fill_viridis_d(begin = 0, end = .85, direction = 1, option = 'viridis') +
  geom_text(position = position_stack(vjust = .5),
            size = 3,
            color = rep(c('black', 'black', 'white', 'white'), 4)) + 
  theme(legend.position = 'top',
        legend.title = element_blank()) + 
  guides(fill = guide_legend(reverse = TRUE))

```





