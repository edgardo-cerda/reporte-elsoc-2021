---
editor_options: 
  markdown: 
    wrap: 72
---

# Movimientos Sociales y Acciones Colectivas


## Ciclo de movilización política y estallido social

### 1.1 ¿Cuál es el movimiento social que usted más valora de esta lista? Según ola del estudio

<!-- ### 1.1 ¿Cuál es el movimiento social que usted más valora de esta lista? Según ola del estudio  -->

```{r include=FALSE}
datos.1.1 <- elsoc_long_2016_2021 %>%
  filter(tipo_atricion == 1 & ola %in% c(4,5) & !c20 %in% c(-888, -999)) %>%
  mutate(ola = factor(ola, levels = c(4,5),
                         labels = c('2019', '2021'))) %>%
  mutate(mov = factor(c20, levels = c(11,12,5,8,6,3,4,7,1,2,10,9),
                         labels = c('Otro',
                                    'Ninguno',
                                    'Diversidad sexual',
                                    'Feminista',
                                    'Provida o Antiaborto',
                                    'Ambiental',
                                    'Indigena',
                                    'Antidelincuencia',
                                    'Estudiantil',
                                    'Laboral',
                                    'Mov Social de Octubre (18/O)',
                                    'Pensiones'))) %>%
  prop(x = mov, by = ola, na.rm = TRUE) %>% 
  sjlabelled::as_label(mov, ola)



g1.1 <- datos.1.1 %>% 
  ggplot(aes(y = prop, x = mov, fill = ola, 
             label = scales::percent(prop, accuracy = .1))) +
  theme_bw() + 
  geom_col(position = 'dodge2') +
  scale_y_continuous(labels = scales::percent,
                     limits = c(0,0.3)) +
  ylab(label = NULL) +
  xlab(label = NULL) +
  scale_fill_viridis_d(begin = .66, end = .33, direction = -1, option = 'viridis') +
  coord_flip() +
  theme(axis.text.x = element_text(size=rel(.9))) +
  guides(fill = guide_legend(reverse = TRUE)) +
  scale_x_discrete(labels = waiver( ))

g1.1
```

### 1.2 Frecuencia de respuesta en "ninguno" ante la pregunta ¿Cuál es el movimiento social que usted más valora de esta lista? según posición política"

<!-- ### 1.2 Frecuencia de respuesta en "ninguno" ante la pregunta ¿Cuál es el movimiento social que usted más valora de esta lista? según posición política  -->

```{r}
datos.1.2 <- elsoc_long_2016_2021 %>%
    filter(tipo_atricion == 1 & c20 %in% c(12)) %>%
  mutate(pos_id = car::recode(c15, recodes = "c(0,1,2,3,4)=1; c(5)=2; c(6,7,8,9,10)=3; c(11,12, -999, -888)=4")) %>%
  mutate(pos_id = factor(pos_id, levels = c(1, 2, 3, 4),
                         labels = c('Izquierda', "Centro", "Derecha", "No se identifica"))) %>%
    mutate(ola = factor(ola, levels = c(1,2,3,4,5),
                         labels = c('2016', '2017', '2018', '2019', '2021')))  %>%
  prop(ola, by  = c(pos_id, c20), na.rm = TRUE)

g1.2 <-datos.1.2 %>% 
    ggplot(aes(y = prop, x = ola, 
               label = as.character(scales::percent(prop, accuracy = .1)))) +
  theme_bw() + 
    geom_col(position = 'dodge2') +
    scale_y_continuous(labels = scales::percent,
                       limits = c(0, 0.5)) +
    ylab(label = NULL) +
    xlab(label = NULL) +
    scale_fill_viridis_d(begin = 0, end = .85, direction = -1, option = 'viridis') +
    facet_wrap(datos.1.2$pos_id)+
    theme(legend.position = 'top',
          legend.title = element_blank()) 
g1.2

```


### 1.3 Alluvial de movimiento social que más valora

```{r}
elsoc_long_2016_2021$movsoc<- car::recode(elsoc_long_2016_2021$c20, 
                                          "1='Progresista';2='Progresista';3='Progresista';
                                          4='Progresista';5='Progresista';6='Conservador';7='Conservador';
                                          8='Progresista';9='Progresista';10='Progresista';11=NA;12='Ninguno';
                                          c(-999,-888)=NA",as.factor=T)
elsoc_long_2016_2021$ola_r<- car::recode(elsoc_long_2016_2021$ola, 
                                          "1='2016';2='2017';3='2018';
                                          4='2019';5='2021'",as.factor=T)
datos.1.3 <- elsoc_long_2016_2021 %>% 
  mutate(movsoc = car::recode(c20, recodes = "1='Progresista';2='Progresista';3='Progresista';
                                          4='Progresista';5='Progresista';6='Conservador';7='Conservador';
                                          8='Progresista';9='Progresista';10='Progresista';11=NA;12='Ninguno';
                                          c(-999,-888)=NA",as.factor=T)) %>% 
  dplyr::filter(tipo_atricion == 1) %>% 
  dplyr::filter(!is.na(movsoc)) %>%
  group_by(idencuesta) %>%
  mutate(n_obs = n()) %>%
  ungroup() %>% 
  mutate(n_ok = (n_obs == max(n_obs))) %>% 
  dplyr::filter(n_ok) %>%  # Quedarse solo con los casos con observaciones completas
  group_by(idencuesta, movsoc, ola_r) %>% 
  summarise(n1 = sum(ponderador02, na.rm = TRUE)) %>%
  group_by(ola_r) %>% 
  mutate(n2 = sum(n1, na.rm = TRUE), porcentaje = n1/n2) %>% 
  ungroup()

etiquetas.1.3 <- datos.1.3 %>% 
  group_by(movsoc, ola_r) %>% 
  summarise(porcentaje = sum(porcentaje, na.rm = TRUE)) %>% 
  mutate(idencuesta = 1)

g1.3 <- ggplot(datos.1.3 , aes(x = ola_r, fill = movsoc, stratum = movsoc, 
                  alluvium = idencuesta, y = porcentaje )) +
  theme_bw() +
  ggalluvial::geom_flow(alpha = .66) + 
  ggalluvial::geom_stratum(linetype = 0) +
  scale_y_continuous(labels = scales::percent) + 
  ylab(label = NULL) +
  xlab(label = NULL) + 
  theme(legend.position = 'top',
        legend.title = element_blank()) +
  scale_fill_viridis_d(begin = 0, end = .85, direction = -1, option = 'viridis') +
  geom_text(data = etiquetas.1.3, 
            aes(label = scales::percent(porcentaje, accuracy = .1)),
            position = position_stack(vjust = .5),
            show.legend = FALSE,
            size = 2.75,
            color = c(rep('black', 5),
                      rep('black', 5),
                      rep('white', 5))) 

g1.3
```


La determinación entre las categorías "Progresista" y "Conservador" se hizo en base a la siguiente agrupación de movimientos sociales:

Progresista: Movimiento social de apoyo a la causa estudiantil, Movimiento social de apoyo a demandas laborales, Movimiento social de grupos ambientalistas, Movimiento social de apoyo a las demandas indígena, Movimiento social de apoyo a la diversidad sexual, Movimiento feminista o de apoyo a la igualdad de género, Movimiento por el cambio al sistema de pensiones, Estallido social del 18 de Octubre de 2019

Conservador: Movimiento social provida o antiaborto, Movimiento social antidelincuencia



### 1.4 Descriptivos generales

```{r}
datos.1.4 <- elsoc_long_2016_2021 %>%
  mutate(movsoc = car::recode(c20, recodes = "1='Progresista';2='Progresista';3='Progresista';
                                          4='Progresista';5='Progresista';6='Conservador';7='Conservador';
                                          8='Progresista';9='Progresista';10='Progresista';11=NA;12='Ninguno';
                                          c(-999,-888)=NA",as.factor=T)) %>%
    filter(tipo_atricion == 1) %>%
    dplyr::filter(!is.na(movsoc)) %>%
  mutate(ola = factor(ola, levels = c(1,2,3,4,5),
                         labels = c('2016', '2017', '2018', '2019', '2021')))  %>%
  prop(movsoc, by  = c(ola), na.rm = TRUE) 

g1.4 <-datos.1.4 %>% 
    #indicar el contenido del gráfico: ejes y relleno (fill) por ola
    ggplot(aes(y = prop, x = movsoc, fill = ola, 
               label = as.character(scales::percent(prop, accuracy = .1)))) +
    #fijar el fondo y el marco del gráfico uniforme
    theme_bw() + 
    #geom_col para usar variable y=porcentaje. 'dodge2' para formato side-to-side
    geom_col(position= 'dodge2') +
    #escala del eje y en porcentajes del 0 al 100%
    scale_y_continuous(labels = scales::percent,
                       limits = c(0, 1)) +
    #Nombres de los ejes se eliminan
    ylab(label = NULL) +
    xlab(label = NULL) +
    #colores oficiales por ola: degradé 'viridis'
    scale_fill_viridis_d(begin = 0, end = .85, direction = -1, option = 'viridis') +
    geom_text(hjust = -.1,
            position = position_dodge(width = 1),
            size= 2.75) +
    #posicionamiento de leyenda arriba
    theme(legend.position = 'top',
          legend.title = element_blank()) +
  coord_flip()

g1.4
```


### 1.5 Cambios en la valoración de movimientos sociales según posición política

```{r}
datos.1.5 <-elsoc_long_2016_2021 %>%
  filter(tipo_atricion == 1 & ola %in% c(3,4,5)) %>%
  mutate(movsoc = car::recode(c20, recodes = 
                "1='Progresista';2='Progresista';3='Progresista';
                 4='Progresista';5='Progresista';6='Conservador';7='Conservador';
                 8='Progresista';9='Progresista';10='Progresista';11=NA;12='Ninguno';
                 c(-999,-888)=NA",as.factor=T)) %>%
  mutate(pos_id = car::recode(c15, recodes = 
                  "c(0,1,2,3,4)=1; c(5)=2; c(6,7,8,9,10)=3; 
                   c(11,12, -999, -888)=4")) %>%
  mutate(pos_id = factor(pos_id, levels = c(1, 2, 3, 4),
                         labels = c('Izquierda', "Centro", "Derecha", 
                                    "No se identifica"))) %>%
  mutate(ola = factor(ola, levels = c(3,4,5),
                         labels = c('2018', '2019', '2021')))  %>%
  dplyr::filter(!is.na(pos_id) & !is.na(movsoc)) %>%
  prop(movsoc, by  = c(ola, pos_id), na.rm = TRUE)

g1.5 <- datos.1.5 %>% 
  ggplot(aes(y = prop, x = pos_id, fill =movsoc, 
             label = as.character(scales::percent(ifelse(prop>.01, prop, NA), accuracy = .1)))) +
  theme_bw() +
  geom_col(position = 'stack') +
  facet_grid(.~ola) +
  scale_y_continuous(labels = scales::percent) +
  ylab(label = NULL) +
  xlab(label = NULL) +
  scale_fill_viridis_d(begin = 0, end = .85, direction = -1, option = 'viridis') +
  geom_text(position = position_stack(vjust = .5),
            size= 2.75,
            color = rep(c(rep('white', 4),
                          rep('white', 4),
                          rep('white', 4)),3)) + 
  theme(legend.position = 'top',
        legend.title = element_blank()) 
g1.5
```


### 1.6 Cambios en la valoración de movimientos sociales según nivel educativo

```{r}
datos.1.6 <- elsoc_long_2016_2021 %>%
  filter(tipo_atricion == 1) %>%
  mutate(movsoc = car::recode(c20, recodes = 
                  "1='Progresista';2='Progresista';3='Progresista';
                   4='Progresista';5='Progresista';6='Conservador';7='Conservador';
                   8='Progresista';9='Progresista';10='Progresista';11=NA;12='Ninguno';
                   c(-999,-888)=NA",as.factor=T)) %>%
  mutate(educ = car::recode(m01, recodes = "c(1,2,3)=1;c(4,5)=2;c(6,7)=3;c(8,9,10)=4")) %>%
  mutate(educ = factor(educ, levels = c(1,2,3,4),
                         labels = c("Basica","Media","Tecnica","Universitaria"))) %>%
    mutate(ola = factor(ola, levels = c(1,2,3,4,5),
                         labels = c('2016', '2017', '2018', '2019', '2021')))  %>%
    dplyr::filter(!is.na(educ) & !is.na(movsoc)) %>%
  prop(movsoc, by  = c(ola, educ), na.rm = TRUE)
  
  
g1.6 <- datos.1.6 %>% 
  ggplot(aes(y = prop, x = educ, fill =movsoc, 
             label = as.character(scales::percent(ifelse(prop>.01, prop, NA), accuracy = .1)))) +
  theme_bw() +
  geom_col(position = 'stack') +
  facet_grid(.~ola) +
  scale_y_continuous(labels = scales::percent) +
  ylab(label = NULL) +
  xlab(label = NULL) +
  scale_fill_viridis_d(begin = 0, end = .85, direction = -1, option = 'viridis') +
  geom_text(position = position_stack(vjust = .5),
            size= 2.75,
            color = rep(c(rep('white', 4),
                          rep('white', 4),
                          rep('white', 4)),5)) + 
  theme(legend.position = 'top',
        legend.title = element_blank())

g1.6
  
```


### 1.7 Valoración de movimientos sociales segun segun participacion

```{r}
datos.1.7 <- elsoc_long_2016_2021 %>%
  mutate(movsoc = car::recode(c20, recodes = "1='Progresista';2='Progresista';3='Progresista';
                                          4='Progresista';5='Progresista';6='Conservador';7='Conservador';
                                          8='Progresista';9='Progresista';10='Progresista';11=NA;12='Ninguno';
                                          c(-999,-888)=NA",as.factor=T)) %>%
  mutate(participacion = car::recode(c22, recodes = 
                         "c(1,2)='1'; 3='2';
                          c(4,5)='3';
                          c(-999,-888)=NA",as.factor=T)) %>%
    mutate(participacion = factor(participacion, levels = c(1,2,3),
                         labels = c('Nunca o\ncasi nunca', 'A veces', 'Frecuente o\nmuy\nfrecuentemente'))) %>%
    filter(tipo_atricion == 1) %>%
    dplyr::filter(!is.na(participacion) & !is.na(movsoc)) %>%
  mutate(ola = factor(ola, levels = c(1,2,3,4,5),
                         labels = c('2016', '2017', '2018', '2019', '2021')))  %>%
  prop(movsoc, by  = c(ola, participacion), na.rm = TRUE)

g1.7 <- datos.1.7 %>% 
  ggplot(aes(y = prop, x = participacion, fill =movsoc, 
             label = as.character(scales::percent(ifelse(prop>.01, prop, NA), accuracy = .1)))) +
  theme_bw() +
  geom_col(position = 'stack') +
  facet_grid(.~ola) +
  scale_y_continuous(labels = scales::percent) +
  ylab(label = NULL) +
  xlab(label = NULL) +
  scale_fill_viridis_d(begin = 0, end = .85, direction = -1, option = 'viridis') +
  geom_text(position = position_stack(vjust = .5),
            size= 2.75,
            color = rep(c(rep('white', 3),
                          rep('white', 3)),5)) + 
  theme(legend.position = 'top',
        legend.title = element_blank())

g1.7
```


### 1.8 Frecuencia de participación en movimientos sociales, según Ola de encuesta. Porcentaje que responde Frecuentemente o Muy frecuentemente

<!-- ### 1.8 Frecuencia de participación en movimientos sociales, según Ola de encuesta. Porcentaje que responde Frecuentemente o Muy frecuentemente  -->

```{r include=FALSE}
datos.1.8 <- elsoc_long_2016_2021 %>%
  mutate(freq_part = car::recode(c22, recodes = "c(1,2,3)=1; c(4,5)=2; else=NA", as.factor = TRUE)) %>%
  filter(tipo_atricion == 1 & freq_part == 2) %>%
  mutate(ola = factor(ola, levels = c(1,2,3,4,5),
                         labels = c('2016', '2017', '2018', '2019', '2021')))  %>%
  prop(ola, by = freq_part, na.rm = TRUE)

g1.8 <- datos.1.8 %>% 
    ggplot(aes(y = prop, x = ola, fill = freq_part, 
               label = as.character(scales::percent(prop, accuracy = .1)))) +
  theme_bw() + 
    geom_col() +
    scale_y_continuous(labels = scales::percent,
                       limits = c(0, 1)) +
    ylab(label = NULL) +
    xlab(label = NULL) +
    scale_fill_viridis_d(begin = 0, end = .85, direction = -1, option = 'viridis') +
    geom_text(vjust = -0.8,
              position = position_dodge(width = .9),
              size= 2.75) +
    theme(legend.position = 'none',   
          legend.title = element_blank())

g1.8
```


## Confianza en instituciones

### 1.9 Bastante o Mucha confianza en el/la Presidente(a) de la República, el Gobierno y el Congreso Nacional según año

```{r}
elsoc_long_2016_2021$conf_cong <- car::recode(as.numeric(elsoc_long_2016_2021$c05_07), 
                                      recodes = "c(1,2)='Nada o Poca';
                                      c(3)='Algo';
                                      c(4,5)='Bastante o Mucha';
                                      else=NA", as.factor = TRUE)
elsoc_long_2016_2021$conf_pres <- car::recode(as.numeric(elsoc_long_2016_2021$c05_08), 
                                      recode = "c(1,2)='Nada o Poca';
                                      c(3)='Algo';
                                      c(4,5)='Bastante o Mucha';
                                      else=NA", as.factor = TRUE) 
elsoc_long_2016_2021$conf_gob <- car::recode(as.numeric(elsoc_long_2016_2021$c05_01), 
                                      recode = "c(1,2)='Nada o Poca';
                                      c(3)='Algo';
                                      c(4,5)='Bastante o Mucha';
                                      else=NA", as.factor = TRUE)

elsoc_diseno <- svydesign(ids = ~segmento, #muestreo por conglomerado a nivel de manzanas (segmento)
                          strata = ~estrato, #muestreo estratificado a nivel ciudad (estato)
                          weights = ~ponderador02, #ponderador de corte transversal
                          nest = TRUE,
                          data = elsoc_long_2016_2021)
datos.pres <- data.frame((svytable(~conf_pres + ola, elsoc_diseno, round = F))) %>% group_by(ola) %>% mutate(p_pres=Freq/sum(Freq))
datos.pres$ola <- NULL

datos.cong <- data.frame((svytable(~conf_cong + ola, elsoc_diseno, round = F))) %>% group_by(ola) %>% mutate(p_cong=Freq/sum(Freq))
datos.cong$ola <- NULL

datos.gob <- data.frame((svytable(~conf_gob + ola, elsoc_diseno, round = F))) %>% group_by(ola) %>% mutate(p_gob=Freq/sum(Freq))

elsoc_diseno <- svydesign(ids = ~segmento, #muestreo por conglomerado a nivel de manzanas (segmento)
                          strata = ~estrato, #muestreo estratificado a nivel ciudad (estato)
                          weights = ~ponderador02, #ponderador de corte transversal
                          nest = TRUE,
                          data = elsoc_long_2016_2021)

datos.grafico.1.9 <- cbind(datos.pres, datos.cong, datos.gob)


datos.1.9 <- datos.grafico.1.9 %>% 
        pivot_longer(cols = starts_with('conf_'))  %>%
        mutate(variable = factor(name,
                             labels = c('Presidente/a de la Republica', 
                                        'Congreso Nacional', 
                                        'Gobierno de Chile'))) %>%
                              filter(value == 'Bastante o Mucha') %>%
                              drop_na() 

datos.1.9$porcentaje <- with(datos.1.9, case_when(
  variable == 'Presidente/a de la Republica' ~ p_pres,
  variable == 'Congreso Nacional' ~ p_cong,
  variable == 'Gobierno de Chile' ~ p_gob))


g1.9 <- ggplot(datos.1.9,aes(y = porcentaje, x = ola, color = variable, group = variable,
               label = as.character(scales::percent(porcentaje, accuracy = .1)))) +
    theme_bw() +  
    geom_line(size = 1) +
    geom_point(size = 1.8) +
    scale_y_continuous(labels = scales::percent,
                       limits = c(0,1)) +
    ylab(label = NULL) +
    xlab(label = NULL) +
    scale_color_viridis_d(begin = .33, end = .66, direction = 1, option = 'viridis') +
    facet_wrap(.~variable)+
    geom_text(vjust = -0.8,
    posilinetion = position_dodge(width = .9),
    size= 1.75) +
    theme(legend.position = 'top',
          legend.title = element_blank())

g1.9
```

### 1.10 Bastante o Mucha confianza en Carabineros, el Poder Judicial y en Partidos Políticos según año

```{r}

elsoc_long_2016_2021$conf_part <- car::recode(as.numeric(elsoc_long_2016_2021$c05_02), 
                                      recodes = "c(1,2)='Nada o Poca';
                                      c(3)='Algo';
                                      c(4,5)='Bastante o Mucha';
                                      else=NA", as.factor = TRUE)
elsoc_long_2016_2021$conf_carab <- car::recode(as.numeric(elsoc_long_2016_2021$c05_03), 
                                      recodes = "c(1,2)='Nada o Poca';
                                      c(3)='Algo';
                                      c(4,5)='Bastante o Mucha';
                                      else=NA", as.factor = TRUE)
elsoc_long_2016_2021$conf_jud <- car::recode(as.numeric(elsoc_long_2016_2021$c05_05), 
                                      recodes = "c(1,2)='Nada o Poca';
                                      c(3)='Algo';
                                      c(4,5)='Bastante o Mucha';
                                      else=NA", as.factor = TRUE)

elsoc_diseno <- svydesign(ids = ~segmento, #muestreo por conglomerado a nivel de manzanas (segmento)
                          strata = ~estrato, #muestreo estratificado a nivel ciudad (estato)
                          weights = ~ponderador02, #ponderador de corte transversal
                          nest = TRUE,
                          data = elsoc_long_2016_2021)

datos.part <- data.frame((svytable(~conf_part + ola, elsoc_diseno, round = F))) %>% group_by(ola) %>% mutate(p_part=Freq/sum(Freq))
datos.part$ola <- NULL

datos.carb <- data.frame((svytable(~conf_carab + ola, elsoc_diseno, round = F))) %>% group_by(ola) %>% mutate(p_carb=Freq/sum(Freq))
datos.carb$ola <- NULL

datos.jud <- data.frame((svytable(~conf_jud + ola, elsoc_diseno, round = F))) %>% group_by(ola) %>% mutate(p_jud=Freq/sum(Freq))

elsoc_diseno <- svydesign(ids = ~segmento, #muestreo por conglomerado a nivel de manzanas (segmento)
                          strata = ~estrato, #muestreo estratificado a nivel ciudad (estato)
                          weights = ~ponderador02, #ponderador de corte transversal
                          nest = TRUE,
                          data = elsoc_long_2016_2021)

datos.grafico.1.10 <- cbind(datos.part, datos.carb, datos.jud)

#trasponer según variable
datos.1.10 <- datos.grafico.1.10 %>% 
        pivot_longer(cols = starts_with('conf_'))  %>%
        mutate(variable = factor(name,
                             labels = c('Partidos Políticos', 
                                        'Carabineros de Chile', 
                                        'Poder Judicial'))) %>%
                              filter(value == 'Bastante o Mucha') %>%
                              drop_na() 

datos.1.10$porcentaje <- with(datos.1.10, case_when(
  variable == 'Carabineros de Chile' ~ p_carb,
  variable == 'Partidos Políticos' ~ p_part,
  variable == 'Poder Judicial' ~ p_jud))

g1.10 <- ggplot(datos.1.10,aes(y = porcentaje, x = ola, color = variable, group = variable,
               label = as.character(scales::percent(porcentaje, accuracy = .1)))) +
    theme_bw() +  
    geom_line(size = 1) +
    geom_point(size = 1.8) +
    scale_y_continuous(labels = scales::percent,
                       limits = c(0,1)) +
    ylab(label = NULL) +
    xlab(label = NULL) +
    scale_color_viridis_d(begin = .33, end = .66, direction = 1, option = 'viridis') +
    facet_wrap(.~variable)+
    geom_text(vjust = -0.8,
    posilinetion = position_dodge(width = .9),
    size= 1.75) +
    theme(legend.position = 'top',
          legend.title = element_blank()) 
g1.10

```


