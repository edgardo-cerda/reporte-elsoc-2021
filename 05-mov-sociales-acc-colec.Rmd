---
editor_options: 
  markdown: 
    wrap: 72
---

# Movimientos Sociales y Acciones Colectivas


## Ciclo de movilización política y estallido social

### 1.1 ¿Cuál es el movimiento social que usted más valora de esta lista? Según ola del estudio

<!-- ### 1.1 ¿Cuál es el movimiento social que usted más valora de esta lista? Según ola del estudio  -->

```{r}
elsoc_long_2016_2021 %>%
  filter(tipo_atricion == 1 & ola %in% c(4,5) & !c20 %in% c(-888, -999)) %>%
  mutate(mov = factor(c20, levels = c(11,12,5,8,6,3,4,7,1,2,10,9),
                         labels = c('Otro',
                                    'Ninguno',
                                    'Diversidad sexual',
                                    'Feminista',
                                    'Provida o Antiaborto',
                                    'Ambiental',
                                    'Indigena',
                                    'Antidelincuencia',
                                    'Estudiantil',
                                    'Laboral',
                                    'Estallido social\nde Octubre 2019',
                                    'Pensiones'))) %>%
  prop(x = mov, by = ola, na.rm = TRUE) %>% 
  sjlabelled::as_label(ola) %>%
  mutate(ola = factor(ola, levels = c('2021', '2019'))) %>% 
  ggplot(aes(y = prop, x = mov, fill = ola, 
             label = scales::percent(prop, accuracy = .1))) +
  theme_bw() + 
  geom_col(position = 'dodge2') +
  scale_y_continuous(labels = scales::percent,
                     limits = c(0,0.3)) +
  ylab(label = NULL) +
  xlab(label = NULL) +
  scale_fill_viridis_d(begin = .66, end = .33, direction = -1, option = 'viridis') +
  coord_flip() +
  theme(axis.text.x = element_text(size=rel(.9)),
        legend.position = 'top') +
  guides(fill = guide_legend(reverse = TRUE)) +
  scale_x_discrete()

```

### 1.2 Frecuencia de respuesta en "ninguno" ante la pregunta ¿Cuál es el movimiento social que usted más valora de esta lista? según posición política"

<!-- ### 1.2 Frecuencia de respuesta en "ninguno" ante la pregunta ¿Cuál es el movimiento social que usted más valora de esta lista? según posición política  -->

```{r}
elsoc_long_2016_2021 %>%
  filter(tipo_atricion == 1 & muestra == 1 & !c20 %in% c(-888,-999) & !c15 %in% c(-888,-999)) %>%
  mutate(pos_id = factor(car::recode(c15, recodes = "0:4 = 1; 5 = 2; 6:10 = 3; 11:12 = 4"),
                       levels = c(1, 2, 3, 4),
                       labels = c('Izquierda', "Centro", "Derecha", "No se identifica"))) %>%
  prop(c20 %in% c(12), by = c(pos_id, ola), na.rm = TRUE) %>% 
  sjlabelled::as_label(ola) %>%
  ggplot(aes(y = prop, x = ola, fill = pos_id, 
               label = scales::percent(prop, accuracy = .1))) +
  theme_bw() + 
    geom_col(position = 'dodge2') +
    scale_y_continuous(labels = scales::percent,
                       limits = c(0, 1)) +
    ylab(label = NULL) +
    xlab(label = NULL) +
    scale_fill_viridis_d(begin = 0, end = .85, direction = -1, option = 'viridis') +
    theme(legend.position = 'top',
          legend.title = element_blank()) 

```


### 1.3 Alluvial de movimiento social que más valora

```{r}
datos.1.3 <- elsoc_long_2016_2021 %>%
  filter(tipo_atricion == 1 & !c15 %in% c(-888, -999)) %>% 
  mutate(movsoc = car::recode(c20, "1:5 = 1; 8:10 = 1; 6:7 = 2; 11:12 = 3"),
         movsoc = factor(movsoc, levels = c(1,2,3),
                         labels = c('Progresista', "Conservador", "Ninguno"))) %>%
  group_by(idencuesta) %>%
  mutate(n_obs = n()) %>%
  ungroup() %>% 
  mutate(n_ok = (n_obs == max(n_obs))) %>% 
  dplyr::filter(n_ok) %>%  # Quedarse solo con los casos con observaciones completas
  group_by(idencuesta, movsoc, ola) %>% 
  summarise(n1 = sum(ponderador02, na.rm = TRUE)) %>%
  group_by(ola) %>% 
  mutate(n2 = sum(n1, na.rm = TRUE), porcentaje = n1/n2) %>% 
  sjlabelled::as_label(ola) %>% 
  ungroup()

etiquetas.1.3 <- datos.1.3 %>% 
  group_by(movsoc, ola) %>% 
  summarise(porcentaje = sum(porcentaje, na.rm = TRUE)) %>% 
  mutate(idencuesta = 1)

g1.3 <- ggplot(datos.1.3 , aes(x = ola, fill = movsoc, stratum = movsoc, 
                  alluvium = idencuesta, y = porcentaje )) +
  theme_bw() +
  ggalluvial::geom_flow(alpha = .66) + 
  ggalluvial::geom_stratum(linetype = 0) +
  scale_y_continuous(labels = scales::percent) + 
  ylab(label = NULL) +
  xlab(label = NULL) + 
  theme(legend.position = 'top',
        legend.title = element_blank()) +
  scale_fill_viridis_d(begin = 0, end = .85, direction = -1, option = 'viridis') +
  geom_text(data = etiquetas.1.3, 
            aes(label = scales::percent(porcentaje, accuracy = .1)),
            position = position_stack(vjust = .5),
            show.legend = FALSE,
            size = 2.75)

g1.3
```


La determinación entre las categorías "Progresista" y "Conservador" se hizo en base a la siguiente agrupación de movimientos sociales:

Progresista: Movimiento social de apoyo a la causa estudiantil, Movimiento social de apoyo a demandas laborales, Movimiento social de grupos ambientalistas, Movimiento social de apoyo a las demandas indígena, Movimiento social de apoyo a la diversidad sexual, Movimiento feminista o de apoyo a la igualdad de género, Movimiento por el cambio al sistema de pensiones, Estallido social del 18 de Octubre de 2019

Conservador: Movimiento social provida o antiaborto, Movimiento social antidelincuencia



### 1.4 Descriptivos generales

```{r}
elsoc_long_2016_2021 %>%
    filter(tipo_atricion == 1 & !c20 %in% c(-888, -999)) %>%
    mutate(movsoc = car::recode(c20, "1:5 = 1; 8:10 = 1; 6:7 = 2; 11:12 = 3"),
         movsoc = factor(movsoc, levels = c(3, 2, 1),
                         labels = c('Ninguno', 'Conservador', 'Progresista'))) %>%
    dplyr::filter(!is.na(movsoc)) %>%
    prop(movsoc, by  = c(ola), na.rm = TRUE)  %>% 
    sjlabelled::as_label(ola) %>% 
    ggplot(aes(y = prop, x = movsoc, fill = ola, 
               label = scales::percent(prop, accuracy = .1))) +
    theme_bw() + 
    geom_col(position= 'dodge2') +
    scale_y_continuous(labels = scales::percent,
                       limits = c(0, 1)) +
    ylab(label = NULL) +
    xlab(label = NULL) +
    scale_fill_viridis_d(begin = 0, end = .85, direction = -1, option = 'viridis') +
    geom_text(hjust = -.1,
            position = position_dodge(width = 1),
            size= 2.75) +
    theme(legend.position = 'top',
          legend.title = element_blank()) +
  coord_flip()

```


### 1.5 Cambios en la valoración de movimientos sociales según posición política

```{r}
datos.1.5 <-elsoc_long_2016_2021 %>%
  filter(tipo_atricion == 1 & ola %in% c(3,4,5)) %>%
 mutate(movsoc = car::recode(c20, recodes = "1='1';2='1';3='1';
                                          4='1';5='1';6='2';7='2';
                                          8='1';9='1';10='1';11=NA;12='3';
                                          c(-999,-888)=NA",as.factor=T)) %>% 
   mutate(movsoc = factor(movsoc, levels = c(1,2,3),
                         labels = c('Progresista', "Conservador", "Ninguno")),
          pos_id = factor(car::recode(c15, recodes = "0:4 = 1; 5 = 2; 6:10 = 3; 11:12 = 4"),
                       levels = c(1, 2, 3, 4),
                       labels = c('Izquierda', "Centro", "Derecha", "No se identifica"))) %>%
  dplyr::filter(!is.na(pos_id) & !is.na(movsoc)) %>%
  prop(movsoc, by  = c(ola, pos_id), na.rm = TRUE)%>% 
  sjlabelled::as_label(ola)

g1.5 <- datos.1.5 %>% 
  ggplot(aes(y = prop, x = pos_id, fill =movsoc, 
             label = as.character(scales::percent(ifelse(prop>.01, prop, NA), accuracy = .1)))) +
  theme_bw() +
  geom_col(position = 'stack') +
  facet_grid(.~ola) +
  scale_y_continuous(labels = scales::percent) +
  ylab(label = NULL) +
  xlab(label = NULL) +
  scale_fill_viridis_d(begin = 0, end = .85, direction = -1, option = 'viridis') +
  geom_text(position = position_stack(vjust = .5),
            size= 2.75,
            color = rep(c(rep('white', 4),
                          rep('white', 4),
                          rep('white', 4)),3)) + 
  theme(legend.position = 'top',
        legend.title = element_blank()) 
g1.5
```


### 1.6 Cambios en la valoración de movimientos sociales según nivel educativo

```{r}
datos.1.6 <- elsoc_long_2016_2021 %>%
  filter(tipo_atricion == 1 & !ola %in% c(1)) %>%
   mutate(movsoc = car::recode(c20, recodes = "1='1';2='1';3='1';
                                          4='1';5='1';6='2';7='2';
                                          8='1';9='1';10='1';11=NA;12='3';
                                          c(-999,-888)=NA",as.factor=T)) %>% 
   mutate(movsoc = factor(movsoc, levels = c(1,2,3),
                         labels = c('Progresista', "Conservador", "Ninguno"))) %>%
  mutate(educ = car::recode(m01, recodes = "c(1,2,3)=1;c(4,5)=2;c(6,7)=3;c(8,9,10)=4")) %>%
  mutate(educ = factor(educ, levels = c(1,2,3,4),
                         labels = c("Basica","Media","Tecnica","Universitaria"))) %>%
    dplyr::filter(!is.na(educ) & !is.na(movsoc)) %>%
  prop(movsoc, by  = c(ola, educ), na.rm = TRUE)%>% 
  sjlabelled::as_label(ola)
  
  
g1.6 <- datos.1.6 %>% 
  ggplot(aes(y = prop, x = educ, fill =movsoc, 
             label = as.character(scales::percent(ifelse(prop>.01, prop, NA), accuracy = .1)))) +
  theme_bw() +
  geom_col(position = 'stack') +
  facet_grid(.~ola) +
  scale_y_continuous(labels = scales::percent) +
  ylab(label = NULL) +
  xlab(label = NULL) +
  scale_fill_viridis_d(begin = 0, end = .85, direction = -1, option = 'viridis') +
  geom_text(position = position_stack(vjust = .5),
            size= 2.75,
            color = rep(c(rep('white', 4),
                          rep('white', 4),
                          rep('white', 4)),4)) + 
  theme(legend.position = 'top',
        legend.title = element_blank())

g1.6
```


### 1.7 Valoración de movimientos sociales segun segun participacion

```{r}
datos.1.7 <- elsoc_long_2016_2021 %>%
  mutate(movsoc = car::recode(c20, recodes = "1='1';2='1';3='1';
                                          4='1';5='1';6='2';7='2';
                                          8='1';9='1';10='1';11=NA;12='3';
                                          c(-999,-888)=NA",as.factor=T)) %>% 
   mutate(movsoc = factor(movsoc, levels = c(1,2,3),
                         labels = c('Progresista', "Conservador", "Ninguno"))) %>%
  mutate(participacion = car::recode(c22, recodes = 
                         "c(1,2)='1'; 3='2';
                          c(4,5)='3';
                          c(-999,-888)=NA",as.factor=T)) %>%
    mutate(participacion = factor(participacion, levels = c(1,2,3),
                         labels = c('Nunca o\ncasi nunca', 'A veces', 'Frecuente o\nmuy\nfrecuentemente'))) %>%
    filter(tipo_atricion == 1) %>%
    dplyr::filter(!is.na(participacion) & !is.na(movsoc)) %>%
  prop(movsoc, by  = c(ola, participacion), na.rm = TRUE)%>% 
  sjlabelled::as_label(ola)

g1.7 <- datos.1.7 %>% 
  ggplot(aes(y = prop, x = participacion, fill =movsoc, 
             label = as.character(scales::percent(ifelse(prop>.01, prop, NA), accuracy = .1)))) +
  theme_bw() +
  geom_col(position = 'stack') +
  facet_grid(.~ola) +
  scale_y_continuous(labels = scales::percent) +
  ylab(label = NULL) +
  xlab(label = NULL) +
  scale_fill_viridis_d(begin = 0, end = .85, direction = -1, option = 'viridis') +
  geom_text(position = position_stack(vjust = .5),
            size= 2.75,
            color = rep(c(rep('white', 3),
                          rep('white', 3)),5)) + 
  theme(legend.position = 'top',
        legend.title = element_blank())

g1.7
```


### 1.8 Frecuencia de participación en movimientos sociales, según Ola de encuesta. Porcentaje que responde Frecuentemente o Muy frecuentemente

<!-- ### 1.8 Frecuencia de participación en movimientos sociales, según Ola de encuesta. Porcentaje que responde Frecuentemente o Muy frecuentemente  -->

```{r}
elsoc_long_2016_2021 %>%
  filter(tipo_atricion == 1 & muestra==1 & !c22 %in% c(-888, -999)) %>%
  prop(c22 %in% 4:5, by  = ola, na.rm = TRUE) %>%
  sjlabelled::as_label(ola) %>% 
  ggplot(aes(y = prop, x = ola, group = 1, 
             label = scales::percent(prop, accuracy = .1))) +
  theme_bw() + 
  geom_line() +
  geom_point() +
  scale_y_continuous(labels = scales::percent,
                     limits = c(0, .25)) +
  ylab(label = NULL) +
  xlab(label = NULL) +
  scale_fill_viridis_d(begin = 0, end = .85, direction = -1, option = 'viridis') +
  geom_text(vjust = -0.8,
            position = position_dodge(width = .9),
            size= 2.75) +
  theme(legend.position = 'none',   
        legend.title = element_blank())

```


## Confianza en instituciones

### 1.9 Bastante o Mucha confianza en el/la Presidente(a) de la República, el Gobierno y el Congreso Nacional según año

```{r}

elsoc_long_2016_2021 %>% 
  filter(tipo_atricion == 1 & !c05_01 %in% c(-888, -999) & !c05_07 %in% c(-888, -999) & !c05_08 %in% c(-888, -999)) %>% 
  pivot_longer(cols = c(c05_01, c05_07, c05_08)) %>% 
  prop(value %in% 4:5, by = c(ola, name), na.rm = TRUE) %>% 
  as_label(ola) %>% 
  mutate(name = factor(name, 
                       levels = c('c05_01', 'c05_07', 'c05_08'),
                       labels = c('Presidente/a de la Republica', 'Congreso Nacional', 'Gobierno de Chile'))) %>% 
  ggplot(aes(y = prop, x = ola, color = name, group = name,
               label = scales::percent(prop, accuracy = .1))) +
    theme_bw() +  
    geom_line(size = 1) +
    geom_point(size = 1.8) +
    scale_y_continuous(labels = scales::percent,
                       limits = c(0,.5)) +
    ylab(label = NULL) +
    xlab(label = NULL) +
    scale_color_viridis_d(begin = .1, end = .66, option = 'viridis') +
    geom_text_repel() +
    theme(legend.position = 'top',
          legend.title = element_blank())

```

### 1.10 Bastante o Mucha confianza en Carabineros, el Poder Judicial y en Partidos Políticos según año

```{r}

elsoc_long_2016_2021 %>% 
  filter(tipo_atricion == 1 & 
           !c05_02 %in% c(-888, -999) & !c05_03 %in% c(-888, -999) & !c05_05 %in% c(-888, -999)) %>% 
  pivot_longer(cols = c(c05_02, c05_03, c05_05)) %>% 
  prop(value %in% 4:5, by = c(ola, name), na.rm = TRUE) %>% 
  as_label(ola) %>% 
  mutate(name = factor(name, 
                       levels = c('c05_02', 'c05_03', 'c05_05'),
                       labels = c('Partidos Políticos', 
                                  'Carabineros de Chile', 
                                  'Poder Judicial'))) %>%
  ggplot(aes(y = prop, x = ola, color = name, group = name,
               label = scales::percent(prop, accuracy = .1))) +
    theme_bw() +  
    geom_line(size = 1) +
    geom_point(size = 1.8) +
    scale_y_continuous(labels = scales::percent,
                       limits = c(0,.5)) +
    ylab(label = NULL) +
    xlab(label = NULL) +
    scale_color_viridis_d(begin = .1, end = .66, option = 'viridis') +
    geom_text_repel() +
    theme(legend.position = 'top',
          legend.title = element_blank())


```


