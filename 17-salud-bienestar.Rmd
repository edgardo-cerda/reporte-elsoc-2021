---
editor_options: 
  markdown: 
    wrap: 72
---

## Salud mental y bienestar

<!-- ###  1 Síntomas de Depresión, según Ola del Estudio -->
```{r depre-wave, echo=FALSE, fig.align='center'}
#------------------GR.1---------------
datos.grafico <- data.frame((svytable(~depr + ola, 
                                      elsoc_diseno, round = F))) %>% 
  group_by(ola) %>% 
  mutate(porcentaje=Freq/sum(Freq)) %>%
  drop_na()

gr.1 <- datos.grafico %>% 
  ggplot(aes(y = porcentaje, x = ola, fill = depr, 
             label = as.character(scales::percent(porcentaje, accuracy = .1)))) + 
  theme_bw() + 
  geom_col(position = 'Stack') +
  scale_y_continuous(labels = scales::percent,
                     limits = c(0, 1)) +
  ylab(label = NULL) +
  xlab(label = NULL) +
  scale_fill_viridis_d(begin = .33, end = .85, direction = -1, option = 'viridis') +
  #cambiar geom_text tal que: Stack y cambio colores
  geom_text(position = position_stack(vjust = .5),
            size= 2.75, color = rep.int(c('black', 'black', 'white', 'white'), 5)) + 
  theme(legend.position = 'top',
        legend.title = element_blank()) +
  ggtitle('Síntomas de Depresión, según Ola del Estudio')

gr.1

```

```{r N1, include=FALSE}
N<-round(sum(datos.grafico$Freq),0)
```
## Brecha de género en Salud Mental


<!-- ###  2 Sintomatología Depresiva por año, según sexo. Porcentaje con síntomas de "Depresion Moderada" o "Depresion Moderada Severa a Severa".  -->
```{r depre-year-sexo, echo=FALSE, fig.align='center'}
#------------------GR.6---------------
elsoc_long$depr_rec <- car::recode(elsoc_long$suma_dep,
                               "c(0,1,2,3,4)='1';
c(5,6,7,8,9)='2';
c(10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27)='3'")

elsoc_diseno <- svydesign(ids = ~segmento, strata = ~estrato, 
                          weights = ~ponderador02, nest = TRUE, data = elsoc_long)
datos.grafico <- data.frame((svytable(~depr_rec + ola + m0_sexo, 
                                      elsoc_diseno, round = F))) %>% 
  group_by(ola, m0_sexo) %>% 
  mutate(porcentaje=Freq/sum(Freq))

datos.subset <- droplevels(subset(datos.grafico, datos.grafico$depr_rec == '3'))

gr.6 <- ggplot(datos.subset, 
               aes(y = porcentaje, x = ola, 
                   color = m0_sexo, group = m0_sexo,
              label = as.character(scales::percent(porcentaje, accuracy = .1)))) +
  theme_bw() +   
  geom_line(size = 1) +
  geom_point(size = 1.8) +
  scale_y_continuous(labels = scales::percent,
                     limits = c(0,0.5)) +
  ylab(label = NULL) +
  xlab(label = NULL) +
  scale_color_viridis_d(begin = .33, end = .55, direction = 1, option = 'viridis') +
  geom_text_repel(posilinetion = position_dodge(width = .9),
                  size= 2.25) + 
  theme(legend.position = 'top',
        legend.title = element_blank()) +
  ggtitle('Sintomatología Depresiva por año, según sexo. Porcentaje con síntomas de “Depresion Moderada” o “Depresion Moderada Severa a Severa”.')

gr.6
 
```
```{r N2, include=FALSE}
N<-round(sum(datos.grafico$Freq),0)
```
<!-- ###  3 Cambios en Síntomas de depresión entre años 2018 y 2021, según sexo -->
```{r depre-sexo, echo=FALSE, fig.align='center'}
#------------------GR.7---------------
#1
elsoc_long$depr <- na.replace(elsoc_long$depr, "NS/NR") #recode NA en categoría "NS/NR"

elsoc_diseno <- svydesign(ids = ~segmento, strata = ~estrato, 
                          weights = ~ponderador02, nest = TRUE, data = elsoc_long)

datos.grafico <- data.frame((svytable(~depr + ola + idencuesta + 
                                        m0_sexo, elsoc_diseno, round = F))) %>% 
  dplyr::filter(Freq>0)  %>% 
  group_by(ola,m0_sexo) %>% 
  mutate(porcentaje=Freq/sum(Freq)) %>% na.omit()

#1.1
subset.grafico <- droplevels(subset(datos.grafico, datos.grafico$ola == '2018' | datos.grafico$ola == '2021'))

#2
etiquetas.grafico <- data.frame((svytable(~depr + ola + m0_sexo, 
                                          elsoc_diseno, round = F))) %>% 
  group_by(ola, m0_sexo) %>% 
  mutate(porcentaje=Freq/sum(Freq)) %>% 
  na.omit() %>% 
  mutate(idencuesta = 1)

#Paso 2.2: crear un subset sólo para los años 2017 y 2019
etiquetas.grafico <- droplevels(subset(etiquetas.grafico, 
                     etiquetas.grafico$ola == '2018' | etiquetas.grafico$ola == '2021'))

gr.7 <- ggplot(subset.grafico, aes(x = ola, fill = depr, stratum = depr, 
                              alluvium = idencuesta, y = porcentaje)) +
  theme_bw() +
  ggalluvial::geom_flow(alpha = .66) + 
  ggalluvial::geom_stratum(linetype = 0) +
  scale_y_continuous(labels = scales::percent) +
  ylab(label = NULL) +
  xlab(label = NULL) +
  theme(legend.position = 'top',
        legend.title = element_blank()) +
  scale_fill_viridis_d(begin = 0, end = .9, direction = -1, option = 'viridis') +
  facet_wrap(.~m0_sexo)+
  geom_text(data = etiquetas.grafico, 
            aes(label = ifelse(porcentaje > 0.1 , scales::percent(porcentaje, accuracy = .1),"")),
            position = position_stack(vjust = .5),
            show.legend = FALSE,
            size = 2.75,
            color = rep('white'))+
  ggtitle('Cambios en Síntomas de depresión entre años 2016 y 2019, según sexo')

gr.7

```

```{r N3, include=FALSE}
N<-round(sum(datos.grafico$Freq),0)
```


<!-- ###  4 Síntomas de Depresión según tramos de edad y sexo (2021). Porcentaje con síntomas de "Depresion Moderada" o "Depresion Moderada Severa a Severa". -->
```{r depre-edad-sexo, echo=FALSE, fig.align='center'}
#------------------GR.8---------------
datos.grafico <- data.frame((svytable(~depr_rec + ola + m0_sexo + edad, 
                                      elsoc_diseno, round = F))) %>% 
  group_by(ola, m0_sexo, edad) %>% 
  mutate(porcentaje=Freq/sum(Freq))

datos.subset <- droplevels(subset(datos.grafico, datos.grafico$ola == '2021' & datos.grafico$depr_rec == '3'))

gr.8 <- ggplot(datos.subset, 
               aes(y = porcentaje, x = edad, 
                   color = m0_sexo, group = m0_sexo,
                   label = as.character(scales::percent(porcentaje, accuracy = .1)))) +
  theme_bw() +   
  geom_line(size = 1) +
  geom_point(size = 1.8) +
  scale_y_continuous(labels = scales::percent,
                     limits = c(0,0.5)) +
  ylab(label = NULL) +
  xlab(label = NULL) +
  scale_color_viridis_d(begin = .33, end = .55, direction = 1, option = 'viridis') +
  geom_text_repel(posilinetion = position_dodge(width = .9),
                  size= 2.25) + 
  theme(legend.position = 'top',
        legend.title = element_blank()) +
  ggtitle('Síntomas de Depresión según tramos de edad y sexo (2021). Porcentaje con síntomas de “Depresion Moderada” o “Depresion Moderada Severa a Severa')

gr.8

```

```{r N4, include=FALSE}
N<-round(sum(datos.grafico$Freq),0)
``` 

## Sintomatología depresiva, sexo y ocupación


<!-- ### 5 Síntomas de Depresión según categoría ocupacional (año 2021). Porcentaje con síntomas de "Depresion Moderada" o "Depresion Moderada Severa a Severa". -->
```{r depre-labstat, echo=FALSE, fig.align='center'}
#------------------GR.9---------------
datos.grafico <- data.frame((svytable(~depr_rec + ola + m0_sexo + socup, 
                                      elsoc_diseno, round = F))) %>% 
  group_by(ola, m0_sexo, socup) %>% 
  mutate(porcentaje=Freq/sum(Freq))

datos.subset <- droplevels(subset(datos.grafico, datos.grafico$ola == '2021' & datos.grafico$depr_rec == '3'))

gr.9 <- datos.subset %>% 
  ggplot(aes(y = porcentaje, x = socup, fill = m0_sexo, 
             label = as.character(scales::percent(porcentaje, accuracy = .1)))) + 
  theme_bw() + 
  geom_col(position = 'dodge2') +
  scale_y_continuous(labels = scales::percent,
                     limits = c(0, 1)) +
  ylab(label = NULL) +
  xlab(label = NULL) +
  scale_fill_viridis_d(begin = .33, end = .65, direction = -1, option = 'viridis') +
  geom_text(vjust = -0.8,
            position = position_dodge(width = .9),
            size= 2.75) +
  theme(legend.position = 'top',
        legend.title = element_blank()) +
  ggtitle('Síntomas de Depresión según categoría ocupacional (año 2021). Porcentaje con síntomas de “Depresion Moderada” o “Depresion Moderada Severa a Severa”')

gr.9


```

En 2021 no hay hombres en la categoría Trabajo doméstico no remunerado $^{*}$

```{r N5, include=FALSE}
N<-round(sum(datos.grafico$Freq),0)
```





