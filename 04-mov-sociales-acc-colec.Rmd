
# Movimientos Sociales y Acciones Colectivas

## Ciclo de movilización política y estallido social

```{r}
elsoc_long_2016_2021 %>%
  filter(tipo_atricion == 1 & ola %in% c(4,5) & !c20 %in% c(-888, -999)) %>%
  mutate(c20 = factor(c20, levels = 1:12,
                      labels = c('Estudiantil', 'Laboral', 'Ambiental',
                                 'Indigena', 'Diversidad sexual', 'Provida o Antiaborto',
                                 'Antidelincuencia', 'Feminista', 'Pensiones',
                                 'Estallido social\nde Octubre 2019', 'Otro', 'Ninguno'))) %>% 
  prop(x = c20, by = ola, na.rm = TRUE) %>% 
  group_by(c20) %>% 
  mutate(orden = mean(ifelse(ola == 5, prop, NA), na.rm = TRUE)) %>% 
  sjlabelled::as_label(ola) %>%
  ggplot(aes(y = prop, x = reorder(c20, orden), fill = fct_rev(ola), 
             label = scales::percent(prop, accuracy = .1))) +
  theme_bw() + 
  geom_col(position = 'dodge2') +
  scale_y_continuous(labels = scales::percent,
                     limits = c(0,0.3)) +
  ylab(label = NULL) +
  xlab(label = NULL) +
  scale_fill_viridis_d(begin = .66, end = .33, direction = -1, option = 'viridis') +
  coord_flip() +
  theme(axis.text.x = element_text(size = rel(.9)),
        legend.position = 'right',
        legend.title = element_blank()) +
  guides(fill = guide_legend(reverse = TRUE)) +
  scale_x_discrete() + 
  ggtitle(label = '¿Cuál es el movimiento social que usted más valora de esta lista?\nSegún ola del estudio (2019-2021)')

```

```{r}

elsoc_long_2016_2021 %>%
  filter(tipo_atricion == 1 & !c20 %in% c(-888,-999)) %>%
  prop(c20 == 12, by = ola, na.rm = TRUE) %>% 
  as_label(ola) %>%
  ggplot(aes(y = prop, x = ola, group = 1, 
             label = scales::percent(prop, accuracy = .1))) +
  theme_bw() + 
  geom_line(color = viridis(1)) + 
  geom_point(color = viridis(1)) + 
  scale_y_continuous(labels = scales::percent, limits = c(0, 1)) +
  geom_text_repel(color = viridis(1), nudge_y = .025) + 
  ylab(label = NULL) +
  xlab(label = NULL) +
  scale_fill_viridis_d(begin = 0, end = .85, direction = -1, option = 'viridis') +
  theme(legend.position = 'top',
        legend.title = element_blank()) + 
  ggtitle(label = '¿Cuál es el movimiento social que más valora? Según ola del estudio',
          subtitle = 'Porcentaje que responde "Ninguno"')


```

```{r}

elsoc_long_2016_2021 %>%
  filter(tipo_atricion == 1 & muestra == 1 & !c20 %in% c(-888,-999) & !c15 %in% c(-888,-999)) %>%
  mutate(pos_id = factor(car::recode(c15, recodes = "0:4 = 1; 5 = 2; 6:10 = 3; 11:12 = 4"),
                       levels = c(1, 2, 3, 4),
                       labels = c('Izquierda', "Centro", "Derecha", "No se\nidentifica"))) %>%
  prop(c20 %in% c(12), by = c(pos_id, ola), na.rm = TRUE) %>% 
  sjlabelled::as_label(ola) %>%
  ggplot(aes(y = prop, x = ola, color = pos_id, group = pos_id,
               label = scales::percent(prop, accuracy = .1))) +
  theme_bw() + 
  geom_point() + 
  geom_line() +
  geom_text_repel() +
  scale_y_continuous(labels = scales::percent,
                     limits = c(0, 1)) +
  ylab(label = NULL) +
  xlab(label = NULL) +
  scale_color_viridis_d(begin = 0, end = .65, direction = -1, option = 'viridis') +
  theme(legend.position = 'right',
        legend.title = element_blank()) +
    ggtitle(label = '¿Cuál es el movimiento social que más valora? Según ola y posición política',
          subtitle = 'Porcentaje que responde "Ninguno"')


```


```{r}

datos.1.3 <- elsoc_long_2016_2021 %>%
  filter(tipo_atricion == 1 & !c15 %in% c(-888, -999)) %>% 
  mutate(movsoc = car::recode(c20, "1:5 = 1; 8:10 = 1; 6:7 = 2; 11:12 = 3"),
         movsoc = factor(movsoc, levels = c(1,2,3),
                         labels = c('Progresista', "Conservador", "Ninguno"))) %>%
  group_by(idencuesta) %>%
  mutate(n_obs = n()) %>%
  ungroup() %>% 
  mutate(n_ok = (n_obs == max(n_obs))) %>% 
  dplyr::filter(n_ok) %>%  # Quedarse solo con los casos con observaciones completas
  group_by(idencuesta, movsoc, ola) %>% 
  summarise(n1 = sum(ponderador02, na.rm = TRUE)) %>%
  group_by(ola) %>% 
  mutate(n2 = sum(n1, na.rm = TRUE), porcentaje = n1/n2) %>% 
  sjlabelled::as_label(ola) %>% 
  ungroup()

etiquetas.1.3 <- datos.1.3 %>% 
  group_by(movsoc, ola) %>% 
  summarise(porcentaje = sum(porcentaje, na.rm = TRUE)) %>% 
  mutate(idencuesta = 1)

g1.3 <- ggplot(datos.1.3 , aes(x = ola, fill = movsoc, stratum = movsoc, 
                  alluvium = idencuesta, y = porcentaje )) +
  theme_bw() +
  ggalluvial::geom_flow(alpha = .66) + 
  ggalluvial::geom_stratum(linetype = 0) +
  scale_y_continuous(labels = scales::percent) + 
  ylab(label = NULL) +
  xlab(label = NULL) + 
  theme(legend.position = 'top',
        legend.title = element_blank()) +
  scale_fill_viridis_d(begin = 0, end = .85, direction = -1, option = 'viridis') +
  geom_text(data = etiquetas.1.3, 
            aes(label = scales::percent(porcentaje, accuracy = .1)),
            position = position_stack(vjust = .5),
            show.legend = FALSE,
            size = 2.75)

g1.3
```

La determinación entre las categorías "Progresista" y "Conservador" se hizo en base a la siguiente agrupación de movimientos sociales:

Progresista: Movimiento social de apoyo a la causa estudiantil, Movimiento social de apoyo a demandas laborales, Movimiento social de grupos ambientalistas, Movimiento social de apoyo a las demandas indígena, Movimiento social de apoyo a la diversidad sexual, Movimiento feminista o de apoyo a la igualdad de género, Movimiento por el cambio al sistema de pensiones, Estallido social del 18 de Octubre de 2019

Conservador: Movimiento social provida o antiaborto, Movimiento social antidelincuencia


```{r}
elsoc_long_2016_2021 %>%
  filter(tipo_atricion == 1 & !c20 %in% c(-888, -999)) %>%
  mutate(movsoc = car::recode(c20, "1:5 = 1; 8:10 = 1; 6:7 = 2; 11:12 = 3"),
       movsoc = factor(movsoc, levels = 1:3,
                       labels = c('Mov. social progresista', 'Mov. social conservador', 'Ninguno'))) %>%
  dplyr::filter(!is.na(movsoc)) %>%
  prop(movsoc, by  = c(ola), na.rm = TRUE)  %>% 
  sjlabelled::as_label(ola) %>% 
  ggplot(aes(y = prop, x = ola, color = movsoc, group = movsoc,
             label = scales::percent(prop, accuracy = .1))) +
  theme_bw() + 
  geom_line() + 
  geom_point() +
  scale_y_continuous(labels = scales::percent,
                     limits = c(0, 1)) +
  ylab(label = NULL) +
  xlab(label = NULL) +
  scale_color_viridis_d(begin = 0, end = .5, direction = -1, option = 'viridis') +
  geom_text_repel() +
  theme(legend.position = 'top',
        legend.title = element_blank()) + 
    ggtitle(label = 'Movimiento social que más valora, Según ola',
          subtitle = 'Movimientos sociales agrupados en 3 categorías')

```

### 1.5 Cambios en la valoración de movimientos sociales según posición política

```{r}
elsoc_long_2016_2021 %>%
  filter(tipo_atricion == 1 & !c20 %in% c(-888, -999) & !c15 %in% c(-888, -999)) %>%
  mutate(pos_id = factor(car::recode(c15, recodes = "0:4 = 1; 5 = 2; 6:10 = 3; 11:12 = 4"),
                       levels = 1:4,
                       labels = c('Izquierda', "Centro", "Derecha", "No se\nidentifica")),
         movsoc = car::recode(c20, "1:5 = 1; 8:10 = 1; 6:7 = 2; 11:12 = 3"),
         movsoc = factor(movsoc, levels = 1:3,
                         labels = c('Mov. social progresista', 'Mov. social conservador', 'Ninguno'))) %>%
  prop(movsoc, by  = c(ola, pos_id), na.rm = TRUE)  %>% 
  sjlabelled::as_label(ola) %>% 
  ggplot(aes(y = prop, x = ola, color = movsoc, group = movsoc,
             label = scales::percent(prop, accuracy = .1))) +
  facet_wrap(.~pos_id) + 
  theme_bw() + 
  geom_line() + 
  geom_point() +
  scale_y_continuous(labels = scales::percent,
                     limits = c(0, 1)) +
  ylab(label = NULL) +
  xlab(label = NULL) +
  scale_color_viridis_d(begin = 0, end = .5, direction = -1, option = 'viridis') +
  geom_text_repel(size = 2.5) +
  theme(legend.position = 'top',
        legend.title = element_blank()) + 
    ggtitle(label = 'Movimiento social que más valora, Según ola',
          subtitle = 'Movimientos sociales agrupados en 3 categorías')

```


### 1.6 Cambios en la valoración de movimientos sociales según nivel educativo

```{r}

elsoc_long_2016_2021 %>%
  filter(tipo_atricion == 1 & !c20 %in% c(-888, -999) & !m01 %in% c(-888, -999)) %>%
  mutate(educ = factor(car::recode(m01, recodes = '1:3 = 1; 4:5 = 2; 6:7 = 3; 8:10 = 4'),
                       levels = 1:4,
                       labels = c("Basica","Media","Tecnica","Universitaria")),
         mov_soc = factor(car::recode(c20, "1:5 = 1; 8:10 = 1; 6:7 = 2; 11:12 = 3"),
                      levels = 1:3,
                      labels = c('Mov. sociales progresistas', 'Mov. sociales conservadores', 'Ninguno'))) %>%
  prop(mov_soc, by  = c(ola, educ), na.rm = TRUE)  %>% 
  sjlabelled::as_label(ola) %>% 
  ggplot(aes(y = prop, x = ola, color = mov_soc, group = mov_soc,
             label = scales::percent(prop, accuracy = .1))) +
  facet_wrap(.~educ) + 
  theme_bw() + 
  geom_line() + 
  geom_point() +
  scale_y_continuous(labels = scales::percent,
                     limits = c(0, 1)) +
  ylab(label = NULL) +
  xlab(label = NULL) +
  scale_color_viridis_d(begin = 0, end = .5, direction = -1, option = 'viridis') +
  geom_text_repel(size = 2.5) +
  theme(legend.position = 'top',
        legend.title = element_blank()) + 
    ggtitle(label = 'Movimiento social que más valora, Según ola',
          subtitle = 'Movimientos sociales agrupados en 3 categorías')

```

```{r}
elsoc_long_2016_2021 %>%
  filter(tipo_atricion == 1 & muestra==1 & !c22 %in% c(-888, -999)) %>%
  prop(c22 %in% 4:5, by  = ola, na.rm = TRUE) %>%
  sjlabelled::as_label(ola) %>% 
  ggplot(aes(y = prop, x = ola, group = 1, 
             label = scales::percent(prop, accuracy = .1))) +
  theme_bw() + 
  geom_line(color = viridis(1)) +
  geom_point(color = viridis(1)) +
  scale_y_continuous(labels = scales::percent,
                     limits = c(0, .25)) +
  ylab(label = NULL) +
  xlab(label = NULL) +
  scale_fill_viridis_d(begin = 0, end = .85, direction = -1, option = 'viridis') +
  geom_text_repel(color = viridis(1), size = 3) + 
  theme(legend.position = 'none',   
        legend.title = element_blank()) + 
  ggtitle(label = 'Participación en movimientos sociales valorados, según ola',
          subtitle = 'Porcentaje que participa Frecuentemente o Muy frecuentemente')

```


```{r}
elsoc_long_2016_2021 %>%
  filter(tipo_atricion == 1 & muestra==1 & !c22 %in% c(-888, -999) & !c20 %in% c(-888, -999)) %>%
  mutate(mov_soc = factor(car::recode(c20, "1:5 = 1; 6:7 = 2; 8:10 = 1; 11:12 = 3"),
                          levels = 1:3,
                          labels = c('Mov. sociales progresistas', 
                                     'Mov. sociales conservadores', 'Ninguno'))) %>%
  prop(c22 %in% 4:5, by  = c(ola, mov_soc), na.rm = TRUE) %>%
  sjlabelled::as_label(ola) %>%
  ggplot(aes(y = prop, x = ola, group = mov_soc, color = mov_soc,
             label = scales::percent(prop, accuracy = .1))) +
  theme_bw() + 
  geom_line() +
  geom_point() +
  scale_y_continuous(labels = scales::percent,
                     limits = c(0,.25)) +
  ylab(label = NULL) +
  xlab(label = NULL) +
  scale_color_viridis_d(begin = 0, end = .85, direction = -1, option = 'viridis') +
  geom_text_repel(color = viridis(1), size = 3) + 
  theme(legend.position = 'top',   
        legend.title = element_blank()) + 
  ggtitle(label = 'Participación en movimientos sociales valorados, según ola',
          subtitle = 'Porcentaje que participa Frecuentemente o Muy frecuentemente')

```





