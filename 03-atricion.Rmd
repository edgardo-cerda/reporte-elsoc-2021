---
editor_options: 
  markdown: 
    wrap: 72
---

# Atrición de la muestra

El diseño de ELSOC contempló entrevistar a 3.000 personas en su muestra original y 1.500 en la muestra refresco. Sin embargo, es habitual que en encuestas panel se reduce el número de participantes, dado que algunos optan voluntariamente por dejar de participar y otras personas no pueden ser recontactadas. Este fenómeno es conocido como atrición, y pueden tener efectos nocivos sobre la utilidad de los datos longitudinales. En el caso de ELSOC, la tasa de atrición es comparativamente baja en comparación a otros estudios similares, por lo que no se considera al momento un problema significativo. A pesar de esto, el año 2018 se introduce una muestra refresco para contraarrestar el efecto de la atrición. 

El año 2021, la atrición presenta un alza importante debido a la mayor dificultad que implica el levantamiento durante la pandemia de COVID-19 y al cambio de modalidad.

```{r, echo=FALSE, warning=FALSE}
options(knitr.kable.NA = '')

elsoc_long_2016_2021 %>% 
  group_by(ola, muestra) %>% 
  summarise(n = n()) %>% 
  group_by(muestra) %>% 
  mutate(atricion = abs(n/lag(n) - 1)) %>% 
  pivot_wider(names_from = muestra, values_from = c(n, atricion)) %>% 
  mutate(n_1 = scales::number(n_1),
         n_2 = scales::number(n_2),
         atricion_1 = scales::percent(atricion_1),
         atricion_2 = scales::percent(atricion_2)) %>% 
  select(ola, n_1, atricion_1, n_2, atricion_2) %>% 
  kbl(align = c('c', 'c', 'c', 'c', 'c'),
      col.name = c('Medición', rep(c('Muestra lograda', 'Atrición'), 2))) %>% 
  kable_styling(full_width = F) %>% 
  kable_classic_2() %>% 
  add_header_above(c(" " = 1, 'Muestra original' = 2, 'Muestra refresco' = 2))

```

## Composición de la muestra


```{r}
elsoc_long_2016_2021 %>% 
  group_by(ola, muestra, m0_sexo) %>% 
  summarise(n = n()) %>%
  group_by(ola, muestra) %>% 
  mutate(prop = n/sum(n)) %>% 
  as_label(ola, muestra, m0_sexo) %>% 
  ggplot(aes(y = prop, x = ola, fill = m0_sexo, 
             label = scales::percent(prop, accuracy = .1))) + 
  theme_bw() + 
  facet_wrap(.~muestra) +
  geom_col(position = 'stack') + 
  scale_y_continuous(labels = scales::percent) +
  ylab(label = NULL) +
  xlab(label = NULL) +
  scale_fill_viridis_d(begin = .33, end = .66, direction = -1, option = 'viridis') +
  geom_text(position = position_stack(vjust = .5), size = 3,
            color = rep(c('black', 'white'), 8)) +
  theme(legend.position = 'top',
        legend.title = element_blank()) 

```


```{r}
elsoc_long_2016_2021 %>% 
  mutate(edadt = factor(car::recode(m0_edad, "18:29 = 1; 30:49 = 2; 50:64 = 3; 65:150 = 4"),
                        levels = 1:4,
                        labels = c('18-29', '30-49', '50-64', '65 o más'))) %>%
  group_by(ola, muestra, edadt) %>% 
  summarise(n = n()) %>%
  group_by(ola, muestra) %>% 
  mutate(prop = n/sum(n)) %>% 
  as_label(ola, muestra, edadt) %>% 
  ggplot(aes(y = prop, x = ola, fill = fct_rev(edadt), 
             label = scales::percent(prop, accuracy = .1))) + 
  theme_bw() + 
  facet_wrap(.~muestra) +
  geom_col(position = 'stack') + 
  scale_y_continuous(labels = scales::percent) +
  ylab(label = NULL) +
  xlab(label = NULL) +
  scale_fill_viridis_d(begin = .1, end = .75, direction = -1, option = 'viridis') +
  geom_text(position = position_stack(vjust = .5), size = 3,
            color = rep(c('white', 'white', 'black', 'black'), 8)) +
  theme(legend.position = 'top',
        legend.title = element_blank()) +
  guides(fill = guide_legend(reverse = TRUE))

```

```{r}

elsoc_long_2016_2021 %>% 
  filter(!m01 %in% c(-888, -999)) %>% 
  mutate(educ = factor(car::recode(m01, recodes = "1:3 = 1; 4:5 = 2; 6:7 = 3; 8:10 = 4"),
                       levels = 1:4,
                       labels = c("Basica", "Media", "Tecnica", "Universitaria"))) %>%
  group_by(ola, muestra, educ) %>% 
  summarise(n = n()) %>%
  group_by(ola, muestra) %>% 
  mutate(prop = n/sum(n)) %>% 
  as_label(ola, muestra, educ) %>% 
  ggplot(aes(y = prop, x = ola, fill = fct_rev(educ), 
             label = scales::percent(prop, accuracy = .1))) + 
  theme_bw() + 
  facet_wrap(.~muestra) +
  geom_col(position = 'stack') + 
  scale_y_continuous(labels = scales::percent) +
  ylab(label = NULL) +
  xlab(label = NULL) +
  scale_fill_viridis_d(begin = .1, end = .75, direction = -1, option = 'viridis') +
  geom_text(position = position_stack(vjust = .5), size = 3,
            color = rep(c('white', 'white', 'black', 'black'), 8)) +
  theme(legend.position = 'top',
        legend.title = element_blank()) +
  guides(fill = guide_legend(reverse = TRUE))


```

```{r}

elsoc_long_2016_2021 %>% 
  mutate(estrato = factor(car::recode(estrato, recodes = "5:6=5"),
                       levels = 1:5,
                       labels = c("Santiago", "Valparaíso", "Concepción",
                                  "Ciudades\ngrandes", "Ciudades medianas\no pequeñas"))) %>%
  group_by(ola, muestra, estrato) %>% 
  summarise(n = n()) %>%
  group_by(ola, muestra) %>% 
  mutate(prop = n/sum(n)) %>% 
  as_label(ola, muestra, estrato) %>% 
  ggplot(aes(y = prop, x = ola, fill = estrato, 
             label = scales::percent(prop, accuracy = .1))) + 
  theme_bw() + 
  facet_wrap(.~muestra) +
  geom_col(position = 'stack') + 
  scale_y_continuous(labels = scales::percent) +
  ylab(label = NULL) +
  xlab(label = NULL) +
  scale_fill_viridis_d(begin = .1, end = .75, direction = -1, option = 'viridis') +
  geom_text(position = position_stack(vjust = .5), size = 3,
            color = rep(c('black', 'black', 'white', 'white', 'white'), 8)) +
  theme(legend.position = 'top',
        legend.title = element_blank())

```

