# Migración
 
## Amenaza realista y amenaza simbólica respecto a inmigrantes
 
<!-- ### 14.1 "Con la llegada de migrantes a Chile, está aumentando el desempleo", según ola y origen de migrantes. Porcentaje de personas que responden "De acuerdo" o Totalmente de acuerdo". -->
```{r amen1-wave, fig.align='center',fig.cap='Con la llegada de migrantes a Chile, está aumentando el desempleo", según ola y origen de migrantes. Porcentaje de personas que responden "De acuerdo" o Totalmente de acuerdo".'}

datos.g14.1 <- elsoc_long_2016_2021 %>% 
  filter(tipo_atricion %in% c(1, 17) & !r12_04 %in% c(-888, -999)) %>% 
  elsoc::prop(r12_04 %in% c(4,5), by = c(ola, cuestion_mig)) %>% 
  sjlabelled::as_label(ola, cuestion_mig)
  
datos.g14.1 %>% 
  ggplot(aes(y = prop, x = ola, color = cuestion_mig, group = cuestion_mig,
             label = scales::percent(prop, accuracy = .1))) +
  theme_bw() +   
  geom_line(size = 1) +
  geom_point(size = 1.8) +
  scale_y_continuous(labels = scales::percent,
                     limits = c(0, 1)) +
  ylab(label = NULL) +
  xlab(label = NULL) +
  scale_color_viridis_d(begin = 0, end = .66, direction = -1, option = 'viridis') +
  ggrepel::geom_text_repel(size= 2.75) +
  theme(legend.position = 'top',
        legend.title = element_blank())

```

<!-- ### 14.2 "Con la llegada de migrantes, Chile está perdiendo su identidad", según ola y origen de migrantes. Porcentaje de personas que responden "De acuerdo" o "Totalmente de acuerdo". -->
```{r amen2-wave, fig.align='center',fig.cap='"Con la llegada de migrantes, Chile está perdiendo su identidad", según ola y origen de migrantes. Porcentaje de personas que responden "De acuerdo" o "Totalmente de acuerdo".'}

datos.g14.2 <- elsoc_long_2016_2021 %>% 
  filter(tipo_atricion %in% c(1, 17) & !r12_03 %in% c(-888, -999)) %>% 
  elsoc::prop(r12_03 %in% c(4,5), by = c(ola, cuestion_mig), na.rm = TRUE) %>% 
  sjlabelled::as_label(ola, cuestion_mig)

datos.g14.2 %>% 
  ggplot(aes(y = prop, x = ola, color = cuestion_mig, group = cuestion_mig,
                           label = scales::percent(prop, accuracy = .1))) +
  theme_bw() +   
  geom_line(size = 1) +
  geom_point(size = 1.8) +
  scale_y_continuous(labels = scales::percent,
                     limits = c(0, 1)) +
  ylab(label = NULL) +
  xlab(label = NULL) +
  scale_color_viridis_d(begin = 0, end = .66, direction = -1, option = 'viridis') +
  ggrepel::geom_text_repel(size= 2.75) +
  theme(legend.position = 'top',
        legend.title = element_blank())
```
<!-- ### 14.3 Confianza en migrantes, según ola y origen de migrantes. Porcentaje de personas que responden “Bastante” o “Mucha confianza”. -->
```{r conf-wave, fig.align='center',fig.cap='Confianza en migrantes, según ola y origen de migrantes. Porcentaje de personas que responden “Bastante” o “Mucha confianza”'}

datos.g14.3 <- elsoc_long_2016_2021 %>% 
  mutate(confianza = ifelse(ola %in% c(1,3), c06_06, r16)) %>% 
  filter(tipo_atricion %in% c(1,17) & !confianza %in% c(-888,-999)) %>% 
  elsoc::prop(confianza %in% c(4,5), by = c(ola, cuestion_mig), na.rm = TRUE) %>% 
  sjlabelled::as_label(ola, cuestion_mig)

datos.g14.3 %>% 
  ggplot(aes(y = prop, x = ola, color = cuestion_mig, group = cuestion_mig,
                          label = as.character(scales::percent(prop, accuracy = .1)))) +
  theme_bw() +   
  geom_line(size = 1) +
  geom_point(size = 1.8) +
  scale_y_continuous(labels = scales::percent,
                     limits = c(0,1)) +
  ylab(label = NULL) +
  xlab(label = NULL) +
  scale_color_viridis_d(begin = 0, end = .66, direction = -1, option = 'viridis') +
  ggrepel::geom_text_repel(size= 2.75) +
  theme(legend.position = 'top',
        legend.title = element_blank())

```

<!-- ### 14.4 Percepción de amenaza realista y simbólica, según grupo de migrantes (2021). Porcentaje de personas que responden "De acuerdo" o Totalmente de acuerdo". -->
```{r amen3-wave, fig.align='center',fig.cap='Percepción de amenaza realista y simbólica, según grupo de migrantes (2021). Porcentaje de personas que responden "De acuerdo" o Totalmente de acuerdo".'}

datos.g14.4 <- elsoc_long_2016_2021 %>%
  filter(tipo_atricion %in% c(1, 17) & ola == 5) %>% 
  select(r12_03, r12_04, estrato_disenno, segmento_disenno, ponderador02, cuestion_mig) %>%
  pivot_longer(cols = c(r12_03, r12_04)) %>% 
  filter(!value %in% c(-888,-999)) %>% 
  prop(value %in% c(4,5), by = c(name, cuestion_mig), na.rm = TRUE) %>% 
  mutate(name = factor(name, levels = c('r12_04', 'r12_03'), 
                       labels = c('Aumenta desempleo', 'Chile pierde su identidad'))) %>% 
  sjlabelled::as_label(cuestion_mig)

datos.g14.4 %>% 
  ggplot(aes(y = prop, x = name, fill = cuestion_mig, 
             label = scales::percent(prop, accuracy = .1))) + 
  theme_bw() + 
  geom_col(position = 'dodge2') +
  scale_y_continuous(labels = scales::percent,
                     limits = c(0, .8)) +
  ylab(label = NULL) +
  xlab(label = NULL) +
  scale_fill_viridis_d(begin = 0, end = .85, direction = -1, option = 'viridis') +
  theme(legend.position = 'top',
        legend.title = element_blank()) +
  geom_text(vjust = -0.8,
            position = position_dodge(width = .9),
            size= 2.75)

```


## Amenaza realista y simbólica respecto a inmigrantes según nivel educacional


<!-- ### 14.5 Percepción de amenaza realista y simbólica respecto a inmigrantes, según nivel educacional (2021). Porcentaje de personas que responden "De acuerdo" o Totalmente de acuerdo". -->
```{r amen-educ, fig.align='center',fig.cap='Percepción de amenaza realista y simbólica respecto a inmigrantes, según nivel educacional (2021). Porcentaje de personas que responden "De acuerdo" o Totalmente de acuerdo".'}

datos.g14.5 <- elsoc_long_2016_2021 %>%
  filter(tipo_atricion %in% c(1, 17) & ola == 5) %>% 
  mutate(educ = factor(car::recode(m01, "c(1,2,3) = 'Basica'; c(4,5) = 'Media'; c(6,7) = 'Tecnica'; c(8,9,10) = 'Universitaria'"))) %>% 
  select(r12_03, r12_04, estrato_disenno, segmento_disenno, ponderador02, educ) %>%
  pivot_longer(cols = c(r12_03, r12_04)) %>% 
  filter(!value %in% c(-888,-999)) %>% 
  prop(value %in% c(4,5), by = c(name, educ), na.rm = TRUE) %>% 
  mutate(name = factor(name, levels = c('r12_04', 'r12_03'), 
                       labels = c('Aumenta desempleo', 'Chile pierde su identidad')))

datos.g14.5 %>% 
  ggplot(aes(y = prop, x = name, fill = educ, 
             label = scales::percent(prop, accuracy = .1))) + 
  theme_bw() + 
  geom_col(position = 'dodge2') +
  scale_y_continuous(labels = scales::percent,
                     limits = c(0, .8)) +
  ylab(label = NULL) +
  xlab(label = NULL) +
  scale_fill_viridis_d(begin = 0, end = .85, direction = -1, option = 'viridis') +
  theme(legend.position = 'top',
        legend.title = element_blank()) +
  geom_text(vjust = -0.8,
            position = position_dodge(width = .9),
            size= 2.75)

```

<!-- ### 14.8 Percepción de amenaza realista y simbólica, según tramo de edad (2021). Porcentaje de personas que responden "De acuerdo" o Totalmente de acuerdo". -->
```{r amen-edad, fig.align='center',fig.cap='Percepción de amenaza realista y simbólica, según tramo de edad (2021). Porcentaje de personas que responden "De acuerdo" o Totalmente de acuerdo".'}

datos.g14.8 <- elsoc_long_2016_2021 %>%
  filter(tipo_atricion %in% c(1, 17) & ola == 5) %>% 
  mutate(edadt = factor(car::recode(m0_edad, "18:29 = 1; 30:49 = 2; 50:64 = 3; 65:150 = 4"),
                           labels = c('18-29', '30-49', '50-64', '65 o más'))) %>% 
  select(r12_03, r12_04, estrato_disenno, segmento_disenno, ponderador02, edadt) %>%
  pivot_longer(cols = c(r12_03, r12_04)) %>% 
  filter(!value %in% c(-888,-999)) %>% 
  prop(value %in% c(4,5), by = c(name, edadt), na.rm = TRUE) %>% 
  mutate(name = factor(name, levels = c('r12_04', 'r12_03'), 
                       labels = c('Aumenta desempleo', 'Chile pierde su identidad')))

datos.g14.8 %>% 
  ggplot(aes(y = prop, x = name, fill = edadt, 
             label = as.character(scales::percent(prop, accuracy = .1)))) + 
  theme_bw() + 
  geom_col(position = 'dodge2') +
  scale_y_continuous(labels = scales::percent,
                     limits = c(0, .8)) +
  ylab(label = NULL) +
  xlab(label = NULL) +
  scale_fill_viridis_d(begin = 0, end = .85, direction = -1, option = 'viridis') +
  theme(legend.position = 'top',
        legend.title = element_blank()) +
  geom_text(vjust = -0.8,
            position = position_dodge(width = .9),
            size= 2.75)
```
